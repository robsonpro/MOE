<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Robson Bruno Dutra Pereira">

<title>5&nbsp; Fatorial de dois níveis replicado – Modelagem e Otimização de Experimentos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06-fatunrep_frac.html" rel="next">
<link href="./04-ANOVA_blocos.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8da5b4427184b79ecddefad3d342027e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05-fat2k.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Fatorial de dois níveis replicado</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Procurar" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Modelagem e Otimização de Experimentos</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Procurar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefácio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-Dists.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Distribuições importantes à modelagem e otimização de Experimentos</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-Testes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Testes de hipóteses para média de uma e duas amostras</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-ANOVA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Planejamento totalmente aleatorizado e análise de variância para um fator</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-ANOVA_blocos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Planejamento com blocos completos aleatorizados</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-fat2k.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Fatorial de dois níveis replicado</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-fatunrep_frac.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Fatorial de dois níveis não replicado, com blocos e fracionado</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-rsm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Metodologia de Superfície de Resposta</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-mix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Experimentos para Misturas</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#introdução" id="toc-introdução" class="nav-link active" data-scroll-target="#introdução"><span class="header-section-number">5.1</span> Introdução</a></li>
  <li><a href="#fatorial-2k-replicado" id="toc-fatorial-2k-replicado" class="nav-link" data-scroll-target="#fatorial-2k-replicado"><span class="header-section-number">5.2</span> Fatorial <span class="math inline">\(2^k\)</span> replicado</a></li>
  <li><a href="#propriedades-do-fatorial-2k" id="toc-propriedades-do-fatorial-2k" class="nav-link" data-scroll-target="#propriedades-do-fatorial-2k"><span class="header-section-number">5.3</span> Propriedades do fatorial <span class="math inline">\(2^k\)</span></a></li>
  <li><a href="#bibliografia" id="toc-bibliografia" class="nav-link" data-scroll-target="#bibliografia">Bibliografia</a></li>
  <li><a href="#exercícios" id="toc-exercícios" class="nav-link" data-scroll-target="#exercícios"><span class="header-section-number">5.4</span> Exercícios</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Fatorial de dois níveis replicado</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Autor</div>
    <div class="quarto-title-meta-contents">
             <p>Robson Bruno Dutra Pereira </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introdução" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="introdução"><span class="header-section-number">5.1</span> Introdução</h2>
<p>Os planejamentos fatoriais são utilizados quando deseja-se obter informações dos efeitos de dois ou mais fatores de interesse de forma simultânea, bem como estudar o efeito da interação entre dois ou mais fatores na resposta avaliada. O planejamento fatorial <span class="math inline">\(2^k\)</span> permite a experimentação sequencial e econômica utilizando o fatorial fracionado <span class="math inline">\(2^{k-p}\)</span> e o fatorial não replicado, os quais serão elucidados no capítulo posterior. É possível utilizar esquemas de confundimento e blocagem com a finalidade de diluir possíveis fontes de variação de ruído no planejamento, sem inflar o erro experimental. Por fim, o planejamento fatorial integra estratégias de experimentação sequencial para busca de região de curvatura e obtenção de modelos quadráticos a partir do planejamento composto central, o qual será elucidado no capítulo de metodologia de superfície de resposta.</p>
<p>Pretende-se inicialmente abordar o planejamento fatorial de dois níveis, o conhecido fatorial <span class="math inline">\(2^k\)</span> replicado.</p>
<p>Neste capítulo são utilizados os pacotes <code>FrF2</code>, <code>pid</code>, <code>vdg</code> e <code>ggpplot2</code>, além das funções básicas do R. Recomenda-se a instalação destes utilizando o comando <code>install.packages("&lt;nome_pacote&gt;")</code>. A instalação é realizada uma única vez, porém o pacote deve ser carregado via <code>library(&lt;nome_pacote&gt;)</code> sempre que deseja-se usar suas funções.</p>
</section>
<section id="fatorial-2k-replicado" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="fatorial-2k-replicado"><span class="header-section-number">5.2</span> Fatorial <span class="math inline">\(2^k\)</span> replicado</h2>
<p>O planejamento fatorial <span class="math inline">\(2^k\)</span> consiste em um projeto experimental onde todos os <span class="math inline">\(k\)</span> fatores de interesse apresentam dois níveis. Este planejamento permite a avaliação de fatores quantitativos ou qualitativos codificando os dois níveis dos fatores em -1 e +1. O número total de experimentos em um planejamento fatorial <span class="math inline">\(2^k\)</span> é <span class="math inline">\(N = n2^{k}\)</span>, onde <span class="math inline">\(n\)</span> é o número de replicações do planejamento. Um planejamento fatorial <span class="math inline">\(2^k\)</span> considera todas as <span class="math inline">\(2^k\)</span> combinações dos níveis dos três fatores de interesse <span class="math inline">\(x_1, x_2,..., x_k\)</span>. A finalidade de testar todas as combinações dos níveis dos fatores é de averiguar o efeito das interações entre os fatores, isto é, de estimar o efeito da mudança de dois ou mais fatores de forma concomitante.</p>
<p>A <a href="#tbl-tab1" class="quarto-xref">Tabela&nbsp;<span>5.1</span></a> apresenta um planejamento fatorial <span class="math inline">\(2^3\)</span> com <span class="math inline">\(N = 8\)</span> experimentos. O planejamento fatorial <span class="math inline">\(2^k\)</span> é comumente codificado com níveis <span class="math inline">\({-1,+1}\)</span>. A codificação evita efeitos de escala e unidades de medida na inferência dos efeitos testados. A ordem padrão dos ensaios garante que todas as <span class="math inline">\(2^3\)</span> combinações dos dois níveis dos <span class="math inline">\(k = 3\)</span> fatores sejam testadas. Para o fator <span class="math inline">\(x_1\)</span> muda-se de nível a cada <span class="math inline">\(2^0 = 1\)</span> linha. Para o fator <span class="math inline">\(x_2\)</span> muda-se de nível a cada cada <span class="math inline">\(2^1 = 2\)</span> linhas. Para o fator <span class="math inline">\(x_k\)</span> muda-se de nível a cada <span class="math inline">\(2^{k−1}\)</span> linhas. E assim sucessivamente, caso o planejamento apresente mais fatores. Um fatorial balanceado deve ter o mesmo número de replicações, <span class="math inline">\(n\)</span>, em cada uma das <span class="math inline">\(2^k\)</span> combinações dos níveis dos fatores.</p>
<div class="cell">
<div id="tbl-tab1" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-tab1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;5.1: Planejamento fatorial <span class="math inline">\(2^3\)</span>
</figcaption>
<div aria-describedby="tbl-tab1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">ordem</th>
<th style="text-align: right;"><em>x</em><sub>1</sub></th>
<th style="text-align: right;"><em>x</em><sub>2</sub></th>
<th style="text-align: right;"><em>x</em><sub>3</sub></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">-1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">-1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>A <a href="#fig-fig1" class="quarto-xref">Figura&nbsp;<span>5.1</span></a> ilustra os planejamentos fatorial <span class="math inline">\(2^2\)</span> e fatorial <span class="math inline">\(2^3\)</span>. Pode-se observar a correspondência da ilustração do fatorial <span class="math inline">\(2^3\)</span>, <a href="#fig-fig1" class="quarto-xref">Figura&nbsp;<span>5.1</span></a>(b), com o planejamento apresentado na <a href="#tbl-tab1" class="quarto-xref">Tabela&nbsp;<span>5.1</span></a>, de forma que a identificação nos vértices do cubo corresponde com a coluna ordem do planejamento. Observa-se que a distância entre os níveis codificados é igual a 2.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-fig1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fig1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/fat_22_23.png" style="width:5in;height:2.5in" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fig1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5.1: Representação (a) fatorial <span class="math inline">\(2^2\)</span>; (b) fatorial <span class="math inline">\(2^3\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
<p>Ao se utilizar um planejamento fatorial <span class="math inline">\(2^k\)</span> é possível estimar:</p>
<ul>
<li><p><span class="math inline">\(k\)</span> efeitos principais;</p></li>
<li><p><span class="math inline">\({k \choose 2}\)</span> interações de segunda ordem;</p></li>
<li><p><span class="math inline">\({k \choose 3}\)</span> interações de terceira ordem;</p></li>
<li><p><span class="math inline">\(\vdots\)</span></p></li>
<li><p><span class="math inline">\({k \choose (k - 1)}\)</span> interações de terceira ordem;</p></li>
<li><p>1 interação de ordem <span class="math inline">\(k\)</span>.</p></li>
</ul>
<p>Um conceito importante para regressão é a matriz do planejamento, ou <em>design matrix</em>, <span class="math inline">\(\mathbf{X}\)</span>, de ordem <span class="math inline">\(N \times r\)</span>. A matriz do planejamento contém uma coluna para cada termo a ser estimado no modelo de regressão, totalizando <span class="math inline">\(r\)</span> colunas. A matriz <span class="math inline">\(\mathbf{X}\)</span>, à seguir, é a matriz do planejamento fatorial <span class="math inline">\(2^3\)</span>. A primeira coluna é unitária, estando relacionada à constante. As três colunas seguintes estão relacionadas aos fatores <span class="math inline">\(x_1\)</span>, <span class="math inline">\(x_2\)</span> e <span class="math inline">\(x_3\)</span>, respectivamente, consistindo no próprio planejamento fatorial <span class="math inline">\(2^3\)</span>. Posteriormente, tem-se as três colunas das interações de segunda ordem <span class="math inline">\(x_{1}x_{2}\)</span>, <span class="math inline">\(x_{1}x_{3}\)</span> e <span class="math inline">\(x_{2}x_{3}\)</span>, sendo cada termo formado pelo produto aos pares dos termos das colunas relacionadas. Finalmente, a última coluna relaciona-se à interação de terceira ordem <span class="math inline">\(x_{1}x_{2}x_{3}\)</span>. Portanto, a interação, consiste matematicamente no produto das variáveis que interagem. Caso o analista não deseje um modelo completo, o número de colunas <span class="math inline">\(r\)</span> da matriz <span class="math inline">\(\mathbf{X}\)</span> pode ser menor. Entretanto, deve-se manter a hierarquia do modelo, de forma que todos os efeitos individuais e interações de menor ordem envolvidos nas interações consideradas estejam presentes. A matriz <span class="math inline">\(\mathbf{X}\)</span> é ortogonal, de forma que para cada fator (cada coluna), cada nível é repetido o mesmo número de vezes <span class="math inline">\(N/2\)</span>, ou de forma análoga, para qualquer coluna <span class="math inline">\(i\)</span>, a soma de todos as linhas é nula, isto é, <span class="math inline">\(\sum_{u=1}^{N}x_{iu} = 0\)</span> e, também, a soma dos produtos dos termos de duas colunas quaisquer é nula, <span class="math inline">\(\sum_{u=1}^{N}x_{iu}x_{ju}\)</span>, tomando duas colunas <span class="math inline">\(i, j\)</span>, com <span class="math inline">\(i \ne j\)</span>, e considerando <span class="math inline">\(u = 1, ..., N\)</span> linhas. A ortogonalidade implica na independência na estimativa dos efeitos.</p>
<p><span class="math display">\[\mathbf{X} = \begin{bmatrix}
                     1 &amp; -1 &amp; -1 &amp; -1 &amp; +1 &amp; +1 &amp; +1 &amp; -1\\
                     1 &amp; +1 &amp; -1 &amp; -1 &amp; -1 &amp; -1 &amp; +1 &amp; +1\\
                     1 &amp; -1 &amp; +1 &amp; -1 &amp; -1 &amp; +1 &amp; -1 &amp; +1\\
                     1 &amp; +1 &amp; +1 &amp; -1 &amp; +1 &amp; -1 &amp; -1 &amp; -1\\
                     1 &amp; -1 &amp; -1 &amp; +1 &amp; +1 &amp; -1 &amp; -1 &amp; +1\\
                     1 &amp; +1 &amp; -1 &amp; +1 &amp; -1 &amp; +1 &amp; -1 &amp; -1\\
                     1 &amp; -1 &amp; +1 &amp; +1 &amp; -1 &amp; -1 &amp; +1 &amp; -1\\
                     1 &amp; +1 &amp; +1 &amp; +1 &amp; +1 &amp; +1 &amp; +1 &amp; +1\\         
\end{bmatrix}\]</span></p>
<p>O fatorial <span class="math inline">\(2^k\)</span> permite o cálculo dos efeitos de forma intuitiva, além de garantir a possibilidade de estimativa de um modelo de regressão linear com interação e de testar significância dos coeficientes de regressão. É possível também utilizar a ANOVA para trabalhar a significância dos efeitos, considerando os contrastes das somas nos dois níveis. Para facilitar o entendimento, seja o exemplo <a href="#exm-ex1" class="quarto-xref">Exemplo&nbsp;<span>5.1</span></a>.</p>
<div id="exm-ex1" class="theorem example">
<p><span class="theorem-title"><strong>Exemplo 5.1</strong></span> Um planejamento fatorial <span class="math inline">\(2^k\)</span> foi utilizado para estudar a conformação a quente de um aço microligado com nióbio. Foram estudados três parâmetros do processo, a saber: <span class="math inline">\(x_1\)</span>: temperatura de desbaste; <span class="math inline">\(x_2\)</span>: temperatura de acabamento; e <span class="math inline">\(x_3\)</span>: temperatura de enrolamento em <span class="math inline">\([^\circ C]\)</span>. A resposta estudada, <span class="math inline">\(y\)</span>, foi o tamanho de grão. A <a href="#tbl-tab2" class="quarto-xref">Tabela&nbsp;<span>5.2</span></a> expõe os níveis do planejamento. Três replicações foram realizadas, totalizando <span class="math inline">\(N =3\times2^{3} = 24\)</span> testes, sendo o planejamento e os 24 resultados dos experimentos expostos na <a href="#tbl-tab3" class="quarto-xref">Tabela&nbsp;<span>5.3</span></a>.</p>
</div>
<div class="cell">
<div id="tbl-tab2" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-tab2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;5.2: Níveis dos fatores
</figcaption>
<div aria-describedby="tbl-tab2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<td style="text-align: left;">Fatores</td>
<td style="text-align: left;">-1</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>X</em><sub>1</sub></td>
<td style="text-align: left;">1000</td>
<td style="text-align: left;">1150</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><em>X</em><sub>2</sub></td>
<td style="text-align: left;">800</td>
<td style="text-align: left;">950</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>X</em><sub>3</sub></td>
<td style="text-align: left;">550</td>
<td style="text-align: left;">700</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div id="tbl-tab3" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-tab3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;5.3: Planejamento fatorial <span class="math inline">\(2^3\)</span>, conformação a quente
</figcaption>
<div aria-describedby="tbl-tab3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Planejamento fatorial 2<sup>3</sup>, conformação a quente</caption>
<colgroup>
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">ordem</th>
<th style="text-align: right;"><em>x</em><sub>1</sub></th>
<th style="text-align: right;"><em>x</em><sub>2</sub></th>
<th style="text-align: right;"><em>x</em><sub>3</sub></th>
<th style="text-align: right;">Grão <span class="math inline">\([\mu m]\)</span></th>
<th style="text-align: right;">Grão <span class="math inline">\([\mu m]\)</span></th>
<th style="text-align: right;">Grão <span class="math inline">\([\mu m]\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">5,1</td>
<td style="text-align: right;">5,0</td>
<td style="text-align: right;">4,9</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">5,6</td>
<td style="text-align: right;">5,7</td>
<td style="text-align: right;">5,2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">8,6</td>
<td style="text-align: right;">8,5</td>
<td style="text-align: right;">9,0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">9,1</td>
<td style="text-align: right;">9,2</td>
<td style="text-align: right;">9,3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7,7</td>
<td style="text-align: right;">8,2</td>
<td style="text-align: right;">8,1</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8,4</td>
<td style="text-align: right;">8,3</td>
<td style="text-align: right;">8,5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13,5</td>
<td style="text-align: right;">13,9</td>
<td style="text-align: right;">14,3</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">14,0</td>
<td style="text-align: right;">14,1</td>
<td style="text-align: right;">14,5</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Inicialmente serão demonstrados os códigos para obtenção do planejamento e análise dos resultados utilizando comandos simples em R, de forma a explicar junto à teoria como realizar as estimativas dos efeitos, coeficientes e testes relacionados. Posteriormente, serão utilizados pacotes mais estruturados para obtenção do planejamento e análise dos resultados de forma direta. Para gerar este planejamento no R, pode-se utilizar o código à seguir.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># definindo os níveis</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># criando o planejamento</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># o comando expand.grid faz todas as combinações </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># dos níveis dos vetores colocados como argumentos</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>planej <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(levels,levels,levels)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># replicando o planejamento três vezes</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>planej <span class="ot">&lt;-</span> <span class="fu">rbind</span>(planej,planej,planej)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># adicionando coluna de ordem padrão e ordem aleatória</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>planej <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>), <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>,<span class="dv">24</span>,<span class="at">replace =</span> F), planej)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># definindo nomes para as colunas</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(planej) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ordem"</span>, <span class="st">"random"</span>, <span class="st">"x1"</span>,<span class="st">"x2"</span>,<span class="st">"x3"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Definindo resposta</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>grao <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">5.6</span>, <span class="fl">8.6</span>, <span class="fl">9.1</span>, <span class="fl">7.7</span>, <span class="fl">8.4</span>, <span class="fl">13.5</span>, <span class="dv">14</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>             <span class="dv">5</span>, <span class="fl">5.7</span>, <span class="fl">8.5</span>, <span class="fl">9.2</span>, <span class="fl">8.2</span>, <span class="fl">8.3</span>, <span class="fl">13.9</span>, <span class="fl">14.1</span>,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>             <span class="fl">4.9</span>, <span class="fl">5.2</span>, <span class="dv">9</span>, <span class="fl">9.3</span>, <span class="fl">8.1</span>, <span class="fl">8.5</span>, <span class="fl">14.3</span>, <span class="fl">14.5</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># atribuindo resposta à coluna y do planejamento </span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>planej<span class="sc">$</span>y <span class="ot">&lt;-</span> grao</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A coluna de ordem aleatória (<em>random</em>) foi gerada para propor uma ordem de condução dos ensaios. A aleatorização da ordem e da seleção dos materiais nos experimentos é importante para diluir o erro experimental devido a variáveis incontroláveis de forma aleatória em todas as condições experimentais. Estas variáveis incontroláveis, ditas de ruído, podem ter origem em condições ambientais ou de fontes de variação intrínsecas do próprio aparato experimental e materiais usados.</p>
<p>Por exemplo, suponha que o analista não tem condições de fixar a temperatura ambiente durante a condução de <span class="math inline">\(N\)</span> experimentos. Se estes ensaios são conduzidos na ordem padrão, caso a temperatura aumente de forma linear no horizonte de tempo de condução dos ensaios, pode ser que o efeito do último fator, <span class="math inline">\(x_k\)</span>, esteja confundido com o efeito da temperatura, visto que a ordem padrão do último fator no fatorial <span class="math inline">\(2^k\)</span> implica na condução dos <span class="math inline">\(N/2\)</span> primeiros ensaios no nível baixo, <span class="math inline">\(x_k=-1\)</span>, e a outra metade no nível alto, <span class="math inline">\(x_k=+1\)</span>. A aleatorização auxiliará na diluição do efeito do fator incontrolável, a temperatura ambiente, de forma aleatória em todas as parcelas experimentais.</p>
<p>De forma geral, o efeito consiste na diferença entre médias. No fatorial <span class="math inline">\(2^k\)</span>, para cada fator de interesse, o efeito é a diferença entre médias da resposta nos níveis alto e baixo. Seja <span class="math inline">\(E_{x_i}\)</span> efeito do fator <span class="math inline">\(x_i\)</span>, <span class="math inline">\(i = 1, ..., k\)</span>, calculado conforme <a href="#eq-eq1" class="quarto-xref">Equação&nbsp;<span>5.1</span></a>.</p>
<p><span id="eq-eq1"><span class="math display">\[
  E_{x_{i}} = \frac{\sum_{x_{i}=+1}y - \sum_{x_{i}=-1}y}{N/2}
\tag{5.1}\]</span></span></p>
<p>Para calcular os efeitos pode-se considerar a matrix <span class="math inline">\(\mathbf{X}\)</span>, de forma que cada efeito seja a soma do produto da respectiva coluna da <span class="math inline">\(\mathbf{X}^T\mathbf{y}\)</span> pelo vetor linha da resposta, <span class="math inline">\(\mathbf{y}\)</span>, dividido por <span class="math inline">\(N/2\)</span>, isto é, <span class="math inline">\(\mathbf{x}_i^T\mathbf{y}\)</span>, onde <span class="math inline">\(\mathbf{x}_i\)</span>, <span class="math inline">\(i = 1, ..., r\)</span> é a i-ésima coluna da matriz <span class="math inline">\(\mathbf{X}\)</span>. Neste caso geral <span class="math inline">\(r = 2^k\)</span>. Porém, há casos onde o analista não deseja estimar todos os efeitos, de forma que <span class="math inline">\(r&lt;2^k\)</span>. O sinal do efeito indica se um acréscimo na variável independente (fator de controle) aumenta - efeito positivo - ou diminui - efeito negativo - a resposta de interesse.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># construindo a matrix X do planejamento do exemplo</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">with</span>(planej, <span class="fu">cbind</span>(<span class="at">I =</span> <span class="dv">1</span>, x1, x2, x3, <span class="at">x1x2 =</span> x1<span class="sc">*</span>x2, <span class="at">x1x3=</span> x1<span class="sc">*</span>x3, <span class="at">x2x3 =</span> x2<span class="sc">*</span>x3, <span class="at">x1x2x3 =</span> x1<span class="sc">*</span>x2<span class="sc">*</span>x3))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculando os efeitos</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>efeitos <span class="ot">&lt;-</span> <span class="fu">crossprod</span>(X, grao)<span class="sc">/</span>(<span class="dv">3</span><span class="sc">*</span><span class="dv">2</span><span class="sc">^</span><span class="dv">3</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(efeitos) <span class="ot">&lt;-</span> <span class="st">"Efeitos"</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>efeitos</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Efeitos
I       18,225
x1       0,425
x2       4,775
x3       4,025
x1x2    -0,025
x1x3    -0,075
x2x3     1,075
x1x2x3  -0,025</code></pre>
</div>
</div>
<p>Graficamente pode-se observar os efeitos lineares de forma simples, conforme ilustra a <a href="#fig-figmaineff" class="quarto-xref">Figura&nbsp;<span>5.2</span></a>. Todos os efeitos lineares foram positivos, de forma que o aumento nos níveis de <span class="math inline">\(x_1\)</span>, <span class="math inline">\(x_2\)</span>, e <span class="math inline">\(x_3\)</span> acarreta um aumento no tamanho de grão. Observando o módulo dos efeitos calculados anteriormente e as inclinações das retas, os efeitos principais em ordem decrescente são <span class="math inline">\(x_2\)</span>, <span class="math inline">\(x_3\)</span>, e <span class="math inline">\(x_1\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-figmaineff" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-figmaineff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-fat2k_files/figure-html/fig-figmaineff-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-figmaineff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5.2: Efeitos principais na resposta tamanho de grão
</figcaption>
</figure>
</div>
</div>
</div>
<p>É importante plotar as interações de segunda ordem graficamente. A <a href="07-rsm.html#fig-interplot" class="quarto-xref">Figura&nbsp;<span>7.8</span></a> apresenta os gráficos de interação de segunda ordem entre <span class="math inline">\(x_1\)</span>, <span class="math inline">\(x_2\)</span> e <span class="math inline">\(x_3\)</span>. Pode-se confirmar que a maior interação foi <span class="math inline">\(x_2x_3\)</span>. Quando <span class="math inline">\(x_3 = -1\)</span> o efeito de <span class="math inline">\(x_2\)</span> é menor na resposta <span class="math inline">\(y\)</span> em relação a <span class="math inline">\(x_3 = +1\)</span>. A interação consiste na mudança provocada no efeito de um fator dada a mudança simultânea no nível de outro fator. Todos os efeitos devem ser testados para averiguar a significância estatística. Os gráficos são um auxílio para interpretação prática dos mesmos. Pode-se observar que no gráfico da interação <span class="math inline">\(x_2x_3\)</span> há maior diferença na inclinação entre as duas retas. O efeito de <span class="math inline">\(x_2\)</span> na resposta tamanho de grão é maior quando <span class="math inline">\(x_3 = +1\)</span>. Pode-se constatar também que as médias relacionadas às quatro combinações desta interação estão mais próximas dos <em>aglomerados</em> formados pelas observações. Possivelmente ela terá maior efeito entre as interações do estudo.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-interplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-interplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-fat2k_files/figure-html/fig-interplot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-interplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5.3: Interações na resposta tamanho de grão
</figcaption>
</figure>
</div>
</div>
</div>
<p>Por fim, um gráfico de interação de terceira ordem pode ser pensado considerando uma das variáveis em painéis. A <a href="#fig-interplot3" class="quarto-xref">Figura&nbsp;<span>5.4</span></a> expõe este gráfico.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-interplot3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-interplot3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-fat2k_files/figure-html/fig-interplot3-1.png" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-interplot3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5.4: Interação de terceira ordem na resposta tamanho de grão
</figcaption>
</figure>
</div>
</div>
</div>
<p>Utilizando um planejamento fatorial <span class="math inline">\(2^k\)</span> é possível estimar um modelo de regressão conforme o exposto na <a href="#eq-regfat3" class="quarto-xref">Equação&nbsp;<span>5.2</span></a>. De forma genérica este modelo pode ser representado conforme <a href="#eq-regfat" class="quarto-xref">Equação&nbsp;<span>5.3</span></a>. Este modelo geral está truncado nas interações de segunda ordem, <span class="math inline">\(\beta_{ij}\)</span>, porém poderiam constar nele interações de até <span class="math inline">\(k\)</span>-ésima ordem. Um modelo de regressão fatorial deve ser hierárquico de forma que os todos os termos principais (efeitos lineares) contidos nas interações de segunda ordem que constam no modelo devem estar presentes no modelo. De forma análoga, caso interações de ordem maior constassem no modelo, interações menores contidas nestas também deveriam ser consideradas.</p>
<p><span id="eq-regfat3"><span class="math display">\[
  \hat{y} = \beta_0 + \beta_1x_1 + \beta_2x_2 + \beta_3x_3 + \beta_{12}x_1x_2 + \beta_{13}x_1x_3 + \beta_{23}x_2x_3
\tag{5.2}\]</span></span></p>
<p><span id="eq-regfat"><span class="math display">\[
  \hat{y} = \beta_0 + \displaystyle\sum_{i=1}^{k}\beta_ix_i+ \displaystyle\sum_{i\ne}\displaystyle\sum_{j}\beta_{ij}x_ix_j
\tag{5.3}\]</span></span></p>
<p>A partir dos efeitos, é possível obter coeficientes de regressão de forma simplória. A constante <span class="math inline">\(\beta_0\)</span> consiste na média de todos os <span class="math inline">\(N\)</span> experimentos. A <a href="#fig-efffac" class="quarto-xref">Figura&nbsp;<span>5.5</span></a> ilustra como o coeficiente linear deve ser interpretado para o fator <span class="math inline">\(x_i\)</span>, <span class="math inline">\(i = 1, ..., k\)</span>. O coeficiente linear, <span class="math inline">\(\beta_i\)</span>, consiste na inclinação da reta, conforme expõe a <a href="#eq-efffac" class="quarto-xref">Equação&nbsp;<span>5.4</span></a>, e mede a mudança na resposta com o acréscimo de uma unidade codificada do fator relacionado. Estes coeficientes de regressão devem ser usados de forma codificada <span class="math inline">\(x_i \in [-1,+1]\)</span>. Como cada interação pode ser representada em uma coluna como o produto dos fatores que interagem, o cálculo dos coeficientes das interações é feito de forma análoga. Tomando uma interação de segunda ordem entre os fatores <span class="math inline">\(x_i\)</span> e <span class="math inline">\(x_j\)</span>, caso o coeficiente, <span class="math inline">\(\beta_{ij}\)</span>, seja positivo, se os fatores que interagem são colocadas ambos no mesmo nível codificado, <span class="math inline">\(x_ix_j = (-1)(-1)\)</span> ou <span class="math inline">\(x_ix_j = (+1)(+1)\)</span>, implica em um incremento na resposta igual ao valor do coeficiente. Ainda considerando o coeficiente positivo, se os fatores são colocadas em níveis codificados distintos, <span class="math inline">\(x_ix_j = (-1)(+1)\)</span> ou <span class="math inline">\(x_ix_j = (+1)(-1)\)</span>, ocorre um decréscimo na resposta igual ao valor do coeficiente.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-efffac" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-efffac-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/effectx1.png" style="width:4in;height:2.5in" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-efffac-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5.5: Efeito linear no fatorial <span class="math inline">\(2^k\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
<p><span id="eq-efffac"><span class="math display">\[
  \beta_i = \tan \theta = \frac{E_{x_{i}}}{2} \text{,  } i = 1, ..., k
\tag{5.4}\]</span></span></p>
<p>Considerando os efeitos obtidos anteriormente no R, pode-se obter os coeficientes de regressão com a sintaxe à seguir.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cálculo dos coeficientes</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Coef <span class="ot">&lt;-</span> efeitos<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Coef) <span class="ot">&lt;-</span> <span class="st">"Coeficientes"</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>Coef</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Coeficientes
I            9,1125
x1           0,2125
x2           2,3875
x3           2,0125
x1x2        -0,0125
x1x3        -0,0375
x2x3         0,5375
x1x2x3      -0,0125</code></pre>
</div>
</div>
<p>O modelo de regressão apresentado na <a href="#eq-efffac" class="quarto-xref">Equação&nbsp;<span>5.4</span></a> é uma aproximação para a resposta de interesse, <span class="math inline">\(\hat{y}\)</span>, servindo para prever a média da resposta considerando os limites (níveis) dos fatores testados experimentalmente. Mesmo se este modelo fosse completo, incluindo todas as interações possíveis até a interação de ordem <span class="math inline">\(k\)</span>, <span class="math inline">\(\beta_{ij...k}\)</span> no caso do fatorial replicado, com <span class="math inline">\(N = n2^k\)</span> experimentos, há possibilidade de estimativa do erro experimental, considerando as <span class="math inline">\(n\)</span> replicações experimentais de cada combinação. O erro experimental é decorrente de fatores incontroláveis presentes durante os ensaios e devido a imperfeições físicas do aparato experimental, erro humano e variações devido a fatores ambientes ou de ruído desconhecidos ou não controlados durante os ensaios. Logo, se o modelo <span class="math inline">\(\hat{y}\)</span> apresenta erro, cada observação <span class="math inline">\(y\)</span> pode ser descrita considerando o estimado pelo modelo de regressão adicionado do termo geral de erro ou resíduo, <span class="math inline">\(y = \hat y + \varepsilon\)</span>, conforme <a href="#eq-yregfat" class="quarto-xref">Equação&nbsp;<span>5.5</span></a>.</p>
<p><span id="eq-yregfat"><span class="math display">\[
y = \beta_0 + \displaystyle\sum_{j=1}^{k}\beta_ix_i+ \displaystyle\sum_{i\ne}\displaystyle\sum_{j}\beta_{ij}x_ix_j + \varepsilon
\tag{5.5}\]</span></span></p>
<p>Os coeficientes de regressão podem ser estimados utilizando o método dos mínimos quadrados. Seja o modelo de regressão fatorial <span class="math inline">\(2^k\)</span> somado do termo de erro apresentado em forma matricial conforme <a href="#eq-yfatmat" class="quarto-xref">Equação&nbsp;<span>5.6</span></a>.</p>
<p><span id="eq-yfatmat"><span class="math display">\[
  \mathbf{y} = \mathbf{X}\boldsymbol{\beta} + \boldsymbol{\varepsilon}
\tag{5.6}\]</span></span></p>
<p>No modelo da <a href="#eq-yfatmat" class="quarto-xref">Equação&nbsp;<span>5.6</span></a> cada termo corresponde explicitamente a:</p>
<p><span class="math display">\[\mathbf{y}_{[N \times 1]} = \begin{bmatrix}
                     y_1 \\ y_2 \\ \vdots \\ y_N                    
\end{bmatrix},
\boldsymbol{\varepsilon}_{[N \times 1]} = \begin{bmatrix}
\varepsilon_1 \\ \varepsilon_2 \\ \vdots \\ \varepsilon_N                 
\end{bmatrix},
\boldsymbol{\beta}_{[r \times 1]} = \begin{bmatrix}
     \beta_0 \\ \beta_1 \\ \vdots \\ \beta_k \\ \beta_{12} \\ \vdots \\ \beta_{(k-1)k}                   
\end{bmatrix}\]</span></p>
<p><span class="math display">\[\mathbf{X}_{[N \times r]} = \begin{bmatrix}
1 &amp; x_{1(-)} &amp; \cdots &amp; x_{k(-)} &amp; x_{1(-)}x_{2(-)} &amp; \cdots &amp; x_{k-1(-)}x_{k(-)}\\
1 &amp; x_{1(+)} &amp; \cdots &amp; x_{k(-)} &amp; x_{1(+)}x_{2(-)} &amp; \cdots &amp; x_{k-1(-)}x_{k(-)}\\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots   &amp; \vdots        &amp; \ddots &amp; \vdots            \\
1 &amp; x_{1(+)} &amp; \cdots &amp; x_{k(+)} &amp; x_{1(+)}x_{2(+)} &amp; \cdots &amp; x_{k-1(+)}x_{k(+)}\\
\end{bmatrix}\]</span></p>
<p>Pode-se obter o vetor de valores previstos com o modelo <span class="math inline">\(\hat{\mathbf{y}}= \mathbf{X}\boldsymbol{\beta}\)</span>. O objetivo do método de mínimos quadrados é escolher os coeficientes de regressão <span class="math inline">\(\boldsymbol{\beta}\)</span> que minimizem a soma dos quadrados dos resíduos, <span class="math inline">\(\sum_{u=1}^{N}\varepsilon_u^2 = \boldsymbol{\varepsilon}^T\boldsymbol{\varepsilon}\)</span>. Uma vez que os resíduos tem média nula, é necessário trabalhar com a soma dos quadrados para viabilizar a minimização do erro acumulado. Tomando a <a href="#eq-yfatmat" class="quarto-xref">Equação&nbsp;<span>5.6</span></a>, o erro pode ser calculado como <span class="math inline">\(\boldsymbol{\varepsilon}  = \mathbf{y} - \mathbf{X}\boldsymbol{\beta}\)</span>. Tomando o quadrado dos erros, tem-se:</p>
<p><span class="math display">\[
\boldsymbol{\varepsilon}^T\boldsymbol{\varepsilon} =
(\mathbf{y} - \mathbf{X}\boldsymbol{\beta})^T(\mathbf{y} - \mathbf{X}\boldsymbol{\beta})
\]</span> <span class="math display">\[
\boldsymbol{\varepsilon}^T\boldsymbol{\varepsilon} =
\mathbf{y}^T\mathbf{y} - \boldsymbol{\beta}^T\mathbf{X}^T\mathbf{y} - \mathbf{y}^T\mathbf{X}\boldsymbol{\beta} + \boldsymbol{\beta}^T\mathbf{X}^T\mathbf{X}\boldsymbol{\beta}
\]</span> <span class="math display">\[
\boldsymbol{\varepsilon}^T\boldsymbol{\varepsilon} =
\mathbf{y}^T\mathbf{y} - 2\boldsymbol{\beta}^T\mathbf{X}^T\mathbf{y} + \boldsymbol{\beta}^T\mathbf{X}^T\mathbf{X}\boldsymbol{\beta}
\]</span></p>
<p>Minimizando a soma dos quadrados dos resíduos em relação a <span class="math inline">\(\beta\)</span>:</p>
<p><span class="math display">\[
\frac{\partial\boldsymbol{\varepsilon}^T\boldsymbol{\varepsilon}}{\partial\boldsymbol{\beta}} =
- 2\mathbf{X}^T\mathbf{y} + 2\mathbf{X}^T\mathbf{X}\hat{\boldsymbol{\beta}} = 0
\]</span></p>
<p>Resolvendo para <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span>, tem-se os estimadores de mínimos quadrados de <span class="math inline">\(\boldsymbol{\beta}\)</span>, conforme <a href="#eq-minsqb" class="quarto-xref">Equação&nbsp;<span>5.7</span></a>.</p>
<p><span id="eq-minsqb"><span class="math display">\[
\hat{\boldsymbol{\beta}} = (\mathbf{X}^T\mathbf{X})^{-1}(\mathbf{X}^T\mathbf{y})
\tag{5.7}\]</span></span></p>
<p>A ortogonalidade da matrix <span class="math inline">\(\mathbf{X}\)</span> implica na estimativa dos coeficientes de regressão de forma independente, isto é, todos os coeficientes são não correlacionados, com mínima variância. Os coeficientes de regressão podem ser obtidos no R com o código à seguir.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># matrix X</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">with</span>(planej, <span class="fu">cbind</span>(<span class="at">I =</span> <span class="dv">1</span>, x1, x2, x3, </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">x1x2 =</span> x1<span class="sc">*</span>x2, <span class="at">x1x3=</span> x1<span class="sc">*</span>x3, <span class="at">x2x3 =</span> x2<span class="sc">*</span>x3,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">x1x2x3 =</span> x1<span class="sc">*</span>x2<span class="sc">*</span>x3))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Coeficientes de mínimos quadrados</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> (<span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X))<span class="sc">%*%</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>grao)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Os resíduos podem ser obtidos no R conforme segue.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># resíduos</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>resi <span class="ot">&lt;-</span> grao <span class="sc">-</span> X<span class="sc">%*%</span>beta</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>É possível calcular a soma dos quadrados dos erros com a finalidade de posteriormente estimar a variância experimental. Uma vez que <span class="math inline">\(\boldsymbol{\varepsilon}  = \mathbf{y} - \mathbf{X}\boldsymbol{\beta} = \mathbf{y} - \hat{\mathbf{y}}\)</span>, tem-se a soma dos quadrados dos erros, conforme segue:</p>
<p><span class="math display">\[
SS_E = \displaystyle\sum_{u=1}^{N}(y_u-\hat{y}_u) =
(\mathbf{y} - \hat{\mathbf{y}})^T(\mathbf{y} - \hat{\mathbf{y}})
\]</span></p>
<p>Tomando um planejamento com <span class="math inline">\(N\)</span> experimentos para estimar um modelo com <span class="math inline">\(r\)</span> termos, o número de graus de liberdade do erro experimental é <span class="math inline">\(DF_E= N-r\)</span>. Logo, a média dos quadrados dos erros, que consiste na estimativa da variância experimental, <span class="math inline">\(\hat{\sigma}^2 = MS_E\)</span>, pode ser obtida conforme <a href="#eq-mse" class="quarto-xref">Equação&nbsp;<span>5.8</span></a>.</p>
<p><span id="eq-mse"><span class="math display">\[
MS_E = \frac{\displaystyle\sum_{u=1}^{N}(y_u-\hat{y}_u)^2}{N-r}
\tag{5.8}\]</span></span></p>
<p>No R pode-se obter a variância experimental conforme segue.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Número de ensaios</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">dim</span>(X)[<span class="dv">1</span>]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Número de termos</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">dim</span>(X)[<span class="dv">2</span>]</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># variância experimental - MSE</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>mse <span class="ot">&lt;-</span> <span class="fu">sum</span>(resi<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(N<span class="sc">-</span>r)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>mse</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0,05875</code></pre>
</div>
</div>
<p>É possível testar a significância dos coeficientes de regressão utilizando a distribuição <span class="math inline">\(t\)</span>. Uma vez que o coeficiente de regressão linear consiste na mudança obtida na resposta com acréscimo de uma unidade, <span class="math inline">\(\beta_j\)</span> consiste no numerador da estatística do teste. Já o denominador da estatística do teste consiste no desvio-padrão da média, isto é <span class="math inline">\(s/\sqrt{N}=\sqrt{MS_E/(n2^k)}\)</span>, seguindo o teorema central do limite. Portanto, a estatística do teste <span class="math inline">\(t\)</span> para os coeficientes de regressão é obtida pela <a href="#eq-tcoef" class="quarto-xref">Equação&nbsp;<span>5.9</span></a>. A hipótese nula do teste é <span class="math inline">\(H_0: \beta_j = 0\)</span>, enquanto a hipótese alternativa é <span class="math inline">\(H_1: \beta_j \ne 0\)</span>. Deste modo, se <span class="math inline">\(|t_{\beta_j}| &gt; |t_{(\alpha/2,N-r)}|\)</span>, rejeita-se <span class="math inline">\(H_0\)</span>.</p>
<p><span id="eq-tcoef"><span class="math display">\[
t_{\beta_j}= \frac{\beta_j}{\sqrt{MS_E/(n2^k)}}
\tag{5.9}\]</span></span></p>
<p>Portanto, pode-se testar a significância dos coeficientes de regressão no R conforme segue. A condição <span class="math inline">\(|t_{\beta_j}| &gt; |t_{(\alpha/2,N-r)}|\)</span> foi satisfeita para a constante <span class="math inline">\(\beta_0\)</span>, para os coeficientes relacionados a <span class="math inline">\(x_1\)</span>, <span class="math inline">\(x_2\)</span> e <span class="math inline">\(x_3\)</span>, ou seja, <span class="math inline">\(\beta_1\)</span>, <span class="math inline">\(\beta_2\)</span> e <span class="math inline">\(\beta_3\)</span> e para o coeficiente da interação entre <span class="math inline">\(x_2x_3\)</span>, <span class="math inline">\(\beta_{23}\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Desvio-padrão da média (erro padrão) dos coeficientes</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>se_coef <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(mse<span class="sc">/</span>N)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># t calculado para os coeficientes</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>t_beta <span class="ot">&lt;-</span> beta<span class="sc">/</span>(se_coef)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(t_beta) <span class="ot">&lt;-</span> <span class="st">"t0"</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>t_beta</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                t0
I      184,1786251
x1       4,2949748
x2      48,2553051
x3      40,6759378
x1x2    -0,2526456
x1x3    -0,7579367
x2x3    10,8637598
x1x2x3  -0,2526456</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># t tabelado</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>t_tab <span class="ot">&lt;-</span> <span class="fu">qt</span>(<span class="at">p =</span> <span class="fl">0.025</span>, <span class="at">df =</span> N<span class="sc">-</span>r)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>t_tab</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -2,119905</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># p-valor </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>pvalue_t <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">pt</span>(<span class="at">q =</span> <span class="fu">abs</span>(t_beta), <span class="at">df =</span> N<span class="sc">-</span>r, <span class="at">lower.tail =</span> F)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pvalue_t) <span class="ot">&lt;-</span> <span class="st">"p-value"</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>pvalue_t</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            p-value
I      4,793840e-28
x1     5,564585e-04
x2     9,265472e-19
x3     1,396616e-17
x1x2   8,037592e-01
x1x3   4,595076e-01
x2x3   8,571502e-09
x1x2x3 8,037592e-01</code></pre>
</div>
</div>
<p>Associado ao teste <span class="math inline">\(t\)</span> para os coeficientes de regressão, pode-se construir um intervalo de confiança para os coeficientes de regressão conforme a <a href="#eq-icbeta" class="quarto-xref">Equação&nbsp;<span>5.10</span></a>, onde <span class="math inline">\(\gamma = 1 - \alpha\)</span> é o nível de confiança adotado.</p>
<p><span id="eq-icbeta"><span class="math display">\[
IC_{\beta_j,\gamma}= \beta_j \pm t_{\gamma}\sqrt{MS_E/(n2^k)}
\tag{5.10}\]</span></span></p>
<p>Além de testar a significância dos coeficientes de regressão utilizando o teste <span class="math inline">\(t\)</span>, no fatorial <span class="math inline">\(2^k\)</span> é comum utilizar a análise de variância para testar a significância dos efeitos. A ANOVA testa a diferença entre médias considerando o particionamento da soma dos quadrados. No fatorial com dois níveis estas quantidades podem ser calculadas considerando o contraste entre as somas dos dois níveis considerados. Para o i-ésimo efeito principal a soma dos quadrados, <span class="math inline">\(SS_{x_i}\)</span>, pode ser calculada conforme a <a href="#eq-ssmain" class="quarto-xref">Equação&nbsp;<span>5.11</span></a>. De forma análoga, a soma dos quadrados para qualquer interação de segunda ordem, <span class="math inline">\(x_ix_j\)</span>, <span class="math inline">\(i \ne j\)</span>, pode ser calculada conforme a <a href="#eq-ssinter" class="quarto-xref">Equação&nbsp;<span>5.12</span></a>, e de forma análoga para as interações de ordem maior. Para o i-ésimo efeito principal, o número de graus de liberdade, no caso do fatorial de dois níveis, é sempre unitário, <span class="math inline">\(DF_{x_i} = 2-1\)</span>. O mesmo reside para os graus de liberdade das interações entre os fatores <span class="math inline">\(x_ix_j\)</span>, <span class="math inline">\(i \ne j\)</span>, visto que a interação consiste no produto, ou seja, <span class="math inline">\(DF_{x_ix_j} = DF_{x_i}DF_{x_j} = 1\times1=1\)</span>. Logo, a média dos quadrados para os efeitos em avaliação no fatorial <span class="math inline">\(2^k\)</span> é igual à soma dos quadrados, <span class="math inline">\(MS_{x_i} = SS_{x_i}/1\)</span>.</p>
<p><span id="eq-ssmain"><span class="math display">\[
SS_{x_i} = \frac{\left(\displaystyle\sum_{x_{i}=+1}y - \displaystyle\sum_{x_{i}=-1}y\right)^2}{n2^k}
\tag{5.11}\]</span></span> <span id="eq-ssinter"><span class="math display">\[
SS_{x_ix_j} = \frac{\left(\displaystyle\sum_{x_{i}x_{j}=+1}y - \displaystyle\sum_{x_{i}x_{j}=-1}y\right)^2}{n2^k}
\tag{5.12}\]</span></span></p>
<p>Para testar a significância dos efeitos no fatorial <span class="math inline">\(2^k\)</span> via ANOVA deve-se calcular a estatística <span class="math inline">\(F_{0(x_i)}\)</span>, como a razão entre a média dos quadrados do efeito de interesse e a média dos quadrados dos erros, <span class="math inline">\(F_{0(x_i)} = MS_{x_i}/MS_E\)</span>. Se <span class="math inline">\(F_0 &gt; F_{(\alpha, 1, N-r)}\)</span>, rejeita-se <span class="math inline">\(H_0\)</span>. O valor na distribuição <span class="math inline">\(F\)</span> com um grau de liberdade unitário no numerador e <span class="math inline">\(\nu\)</span> graus de liberdade no numerador é igual ao quadrado do valor <span class="math inline">\(t\)</span> com <span class="math inline">\(\nu\)</span> graus de liberdade, estando ambas estatísticas associadas à mesma probabilidade, isto é, <span class="math inline">\(F_{(\alpha,1,\nu)}=t_{(\alpha,\nu)}^2\)</span>. Deste modo, não há diferença na conclusão em relação à significância dos efeitos obtida com a ANOVA e com o teste <span class="math inline">\(t\)</span> para os coeficientes de regressão. Entretanto, pelo sinal da estatística <span class="math inline">\(t\)</span> já é possível afirmar se o efeito é positivo ou negativo, enquanto a estatística <span class="math inline">\(F\)</span> é sempre positiva, visto que lida com a razão entre somas dos quadrados e tem domínio nos reais positivos, <span class="math inline">\(F \in [0,+\infty)\)</span>. Em ambos os testes o p-valor será o mesmo e, logicamente, se <span class="math inline">\(p-valor &lt; \alpha\)</span>, rejeita-se <span class="math inline">\(H_0\)</span>.</p>
<p>Pode-se utilizar o código seguir para obter os resultados da ANOVA.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Soma dos quadrados dos efeitos</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>SSx <span class="ot">&lt;-</span> <span class="fu">crossprod</span>(X[,<span class="sc">-</span><span class="dv">1</span>], grao)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>(<span class="dv">3</span><span class="sc">*</span><span class="dv">2</span><span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Média dos quadrados dos efeitos</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>MSx <span class="ot">&lt;-</span> SSx<span class="sc">/</span><span class="dv">1</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(MSx) <span class="ot">&lt;-</span> <span class="st">"Média dos quadrados"</span> </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>MSx</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Média dos quadrados
x1                 1,08375
x2               136,80375
x3                97,20375
x1x2               0,00375
x1x3               0,03375
x2x3               6,93375
x1x2x3             0,00375</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Valor F calculado</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>F0_x <span class="ot">&lt;-</span> MSx<span class="sc">/</span>mse</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(F0_x) <span class="ot">&lt;-</span> <span class="st">"F0"</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>F0_x</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 F0
x1     1,844681e+01
x2     2,328574e+03
x3     1,654532e+03
x1x2   6,382979e-02
x1x3   5,744681e-01
x2x3   1,180213e+02
x1x2x3 6,382979e-02</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># F tabelado</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>Ftab <span class="ot">&lt;-</span> <span class="fu">qf</span>(<span class="at">p =</span> <span class="fl">0.05</span>, <span class="at">df1 =</span> <span class="dv">1</span>, <span class="at">df2 =</span> N<span class="sc">-</span>r, <span class="at">lower.tail =</span> F)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>Ftab</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4,493998</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># P-valor</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>pvalue_F <span class="ot">&lt;-</span> <span class="fu">pf</span>(<span class="at">q =</span> F0_x, <span class="at">df1 =</span> <span class="dv">1</span>, <span class="at">df2 =</span> N<span class="sc">-</span>r, <span class="at">lower.tail =</span> F)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pvalue_F) <span class="ot">&lt;-</span> <span class="st">"p-valor"</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>pvalue_F</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            p-valor
x1     5,564585e-04
x2     9,265472e-19
x3     1,396616e-17
x1x2   8,037592e-01
x1x3   4,595076e-01
x2x3   8,571502e-09
x1x2x3 8,037592e-01</code></pre>
</div>
</div>
<p>Para avaliar a performance do modelo obtido, pode-se calcular as estatísticas de ajuste. Os coeficientes de determinação no fatorial <span class="math inline">\(2^k\)</span> podem ser obtidos de forma análoga ao realizado na ANOVA para um fator. No R, o cálculo pode ser realizado conforme segue. Apesar do alto ajuste, foi observado que há alguns efeitos que não foram estatisticamente significativos. Deste modo, pode-se optar por reduzir o modelos caso seja desejável melhorar o ajuste. Para isto, basta remover a coluna do efeito a ser removido da matriz <span class="math inline">\(\mathbf{X}\)</span>. Geralmente, ao se remover do modelo termos não significativos, diminui-se o erro experimental, <span class="math inline">\(\hat{\sigma}^2 = MS_E\)</span>, uma vez que se aumenta o número de graus de liberdade para estimativa deste. Consequentemente, aumenta-se <span class="math inline">\(R_{aj}^2\)</span> e diminui-se <span class="math inline">\(R^2\)</span>, o que é positivo, visto que o primeiro é uma medida mais fiel para estimar a proporção da variabilidade dos dados explicada pelo modelo, por levar em conta os graus de liberdade. E quanto mais próximo o valor das duas métricas de ajuste, mais confiáveis estas são.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># coef de determinação simples</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>R2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(SSx)<span class="sc">/</span><span class="fu">sum</span>(((grao)<span class="sc">-</span><span class="fu">mean</span>(grao))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>R2</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0,9961318</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># coef de determinação ajustado</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>R2aj <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> mse<span class="sc">/</span><span class="fu">var</span>(grao)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>R2aj</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0,9944394</code></pre>
</div>
</div>
<p>Os cálculos demonstrados para regressão, teste <span class="math inline">\(t\)</span> para os coeficientes e ANOVA foram realizados com a finalidade de entender a modelagem e os testes passo a passo. Entretanto, o R possui pacotes e comandos estruturados que viabilizam um resultado organizado com menos trabalho.</p>
<p>Utilizando o pacote <code>FrF2</code> pode-se criar e analisar planejamentos fatorias <span class="math inline">\(2^k\)</span>. Junto com este pacote podem ser utilizadas funções base do R como <code>lm</code> e <code>aov</code> para obter, respectivamente, o modelo de regressão, teste <span class="math inline">\(t\)</span> e a ANOVA. O primeiro passo é carregar o pacote <code>FrF2</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># carregando o pacote FrF2</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FrF2)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pode-se criar o planejamento com o comando <code>FrF2</code>. Observe que o planejamento pode ser criado considerando os níveis decodificados dos fatores de interesse. É possível aleatorizar os ensaios com <code>randomize = T</code>. Entretanto, só é recomendado a aleatorização ao gerar o planejamento antes de ir para o laboratório. Para apresentar os resultados em um trabalho acadêmico, a ordem padrão facilita a visualização dos efeitos e compreensão dos resultados. Posteriormente à criação do planejamento, pode-se adicionar a resposta com o comando <code>add.response</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando o planejamento</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">FrF2</span>(<span class="at">nruns =</span> <span class="dv">8</span>, </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">nfactors =</span> <span class="dv">3</span>, </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">factor.names=</span><span class="fu">list</span>(<span class="at">x1=</span><span class="fu">c</span>(<span class="dv">1000</span>,<span class="dv">1150</span>),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">x2=</span><span class="fu">c</span>(<span class="dv">800</span>,<span class="dv">950</span>),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">x3=</span><span class="fu">c</span>(<span class="dv">550</span>,<span class="dv">700</span>)),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">replications =</span> <span class="dv">3</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">randomize =</span> F)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>plan <span class="ot">&lt;-</span> <span class="fu">add.response</span>(plan, grao)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(plan)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
FrF2(nruns = 8, nfactors = 3, factor.names = list(x1 = c(1000, 
    1150), x2 = c(800, 950), x3 = c(550, 700)), replications = 3, 
    randomize = F)

Experimental design of type  full factorial 
8  runs
each run independently conducted  3  times

Factor settings:
    x1  x2  x3
1 1000 800 550
2 1150 950 700

Responses:
[1] grao

The design itself:
   run.no run.no.std.rp   x1  x2  x3 Blocks grao
1       1           1.1 1000 800 550     .1  5,1
2       2           2.1 1150 800 550     .1  5,6
3       3           3.1 1000 950 550     .1  8,6
4       4           4.1 1150 950 550     .1  9,1
5       5           5.1 1000 800 700     .1  7,7
6       6           6.1 1150 800 700     .1  8,4
7       7           7.1 1000 950 700     .1 13,5
8       8           8.1 1150 950 700     .1 14,0
9       9           1.2 1000 800 550     .2  5,0
10     10           2.2 1150 800 550     .2  5,7
11     11           3.2 1000 950 550     .2  8,5
12     12           4.2 1150 950 550     .2  9,2
13     13           5.2 1000 800 700     .2  8,2
14     14           6.2 1150 800 700     .2  8,3
15     15           7.2 1000 950 700     .2 13,9
16     16           8.2 1150 950 700     .2 14,1
17     17           1.3 1000 800 550     .3  4,9
18     18           2.3 1150 800 550     .3  5,2
19     19           3.3 1000 950 550     .3  9,0
20     20           4.3 1150 950 550     .3  9,3
21     21           5.3 1000 800 700     .3  8,1
22     22           6.3 1150 800 700     .3  8,5
23     23           7.3 1000 950 700     .3 14,3
24     24           8.3 1150 950 700     .3 14,5
class=design, type= full factorial 
NOTE: columns run.no and run.no.std.rp  are annotation, 
 not part of the data frame</code></pre>
</div>
</div>
<p>Uma forma mais simples de obter a matriz do planejamento é utilizando o comando <code>model.matrix</code>, conforme segue.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># matriz do planejamento</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span>x1<span class="sc">*</span>x2<span class="sc">*</span>x3, <span class="at">data=</span>plan)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>X</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept) x11 x21 x31 x11:x21 x11:x31 x21:x31 x11:x21:x31
1            1  -1  -1  -1       1       1       1          -1
2            1   1  -1  -1      -1      -1       1           1
3            1  -1   1  -1      -1       1      -1           1
4            1   1   1  -1       1      -1      -1          -1
5            1  -1  -1   1       1      -1      -1           1
6            1   1  -1   1      -1       1      -1          -1
7            1  -1   1   1      -1      -1       1          -1
8            1   1   1   1       1       1       1           1
9            1  -1  -1  -1       1       1       1          -1
10           1   1  -1  -1      -1      -1       1           1
11           1  -1   1  -1      -1       1      -1           1
12           1   1   1  -1       1      -1      -1          -1
13           1  -1  -1   1       1      -1      -1           1
14           1   1  -1   1      -1       1      -1          -1
15           1  -1   1   1      -1      -1       1          -1
16           1   1   1   1       1       1       1           1
17           1  -1  -1  -1       1       1       1          -1
18           1   1  -1  -1      -1      -1       1           1
19           1  -1   1  -1      -1       1      -1           1
20           1   1   1  -1       1      -1      -1          -1
21           1  -1  -1   1       1      -1      -1           1
22           1   1  -1   1      -1       1      -1          -1
23           1  -1   1   1      -1      -1       1          -1
24           1   1   1   1       1       1       1           1
attr(,"assign")
[1] 0 1 2 3 4 5 6 7
attr(,"contrasts")
attr(,"contrasts")$x1
     [,1]
1000   -1
1150    1

attr(,"contrasts")$x2
    [,1]
800   -1
950    1

attr(,"contrasts")$x3
    [,1]
550   -1
700    1</code></pre>
</div>
</div>
<p>Para realizar a análise basta utilizar o comando <code>lm</code> com o nome dado ao planejamento criado anteriormente como argumento. É importante utilizar o comando <code>summary</code> para exibir o resultado, viabilizando não somente a visualização do modelo, mas também o teste da significância dos coeficientes. Pode-se observar que o pacote <code>FrF2</code> apresenta o modelo com interações de até segunda ordem. A proposta da autora está de acordo com a adoção do fatorial <span class="math inline">\(2^k\)</span> em estratégias sequenciais para obtenção de modelos quadráticos para otimização. Ao comparar os resultados obtidos abaixo com os obtidos anteriormente, é importante justificar que a diferença aqui é que o efeito de terceira ordem não foi considerado, de forma que o erro experimental ganha um grau de liberdade.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regressão e teste t para coeficientes</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># O comando lm aqui é do pacote FrF2/DoE.base</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>lm_grao <span class="ot">&lt;-</span> <span class="fu">lm</span>(plan) </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_grao)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of observations used: 24 
Formula:
grao ~ (x1 + x2 + x3)^2

Call:
lm.default(formula = fo, data = model.frame(fo, data = formula))

Residuals:
    Min      1Q  Median      3Q     Max 
-0,3875 -0,1125  0,0125  0,1125  0,4125 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  9,11250    0,04809 189,469  &lt; 2e-16 ***
x11          0,21250    0,04809   4,418 0,000376 ***
x21          2,38750    0,04809  49,642  &lt; 2e-16 ***
x31          2,01250    0,04809  41,844  &lt; 2e-16 ***
x11:x21     -0,01250    0,04809  -0,260 0,798060    
x11:x31     -0,03750    0,04809  -0,780 0,446282    
x21:x31      0,53750    0,04809  11,176 2,96e-09 ***
---
Signif. codes:  0 '***' 0,001 '**' 0,01 '*' 0,05 '.' 0,1 ' ' 1

Residual standard error: 0,2356 on 17 degrees of freedom
Multiple R-squared:  0,9961,    Adjusted R-squared:  0,9947 
F-statistic: 726,7 on 6 and 17 DF,  p-value: &lt; 2,2e-16</code></pre>
</div>
</div>
<p>Para testar os efeitos via ANOVA basta utilizar o código à seguir. Pode-se averiguar que os p-valores são iguais aos obtidos no teste <span class="math inline">\(t\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ANOVA</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>anova_grao <span class="ot">&lt;-</span> <span class="fu">aov</span>(lm_grao)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(anova_grao)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq  F value   Pr(&gt;F)    
x1           1   1,08    1,08   19,522 0,000376 ***
x2           1 136,80  136,80 2464,279  &lt; 2e-16 ***
x3           1  97,20   97,20 1750,955  &lt; 2e-16 ***
x1:x2        1   0,00    0,00    0,068 0,798060    
x1:x3        1   0,03    0,03    0,608 0,446282    
x2:x3        1   6,93    6,93  124,899 2,96e-09 ***
Residuals   17   0,94    0,06                      
---
Signif. codes:  0 '***' 0,001 '**' 0,01 '*' 0,05 '.' 0,1 ' ' 1</code></pre>
</div>
</div>
<p>Posteriormente, pode-se prosseguir à análise das pressuposições. Pelo teste de Shapiro-Wilk confirma-se a não rejeição da hipótese de normalidade dos resíduos. Graficamente, pela <a href="#fig-resigrao" class="quarto-xref">Figura&nbsp;<span>5.6</span></a> pode-se confirmar a independência dos resíduos em relação aos valores previstos (<em>residuals vs fitted</em>), um bom ajuste dos resíduos em relação aos quantis da distribuição normal (<em>normal Q-Q</em>), a inexistência de <em>outliers</em> dos resíduos (<em>scale-location</em>) e homogeneidade dos resíduos nos níveis dos fatores (<em>constant leverage</em>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraindo resíduos</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>resi <span class="ot">&lt;-</span> lm_grao<span class="sc">$</span>residuals</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Analisando normalidade</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(resi)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  resi
W = 0,97971, p-value = 0,8904</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráficos de resíduos</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm_grao)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-resigrao" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-resigrao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-fat2k_files/figure-html/fig-resigrao-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-resigrao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5.6: Gráfico de resíduos para o tamanho de grão, modelo com termos de até segunda ordem
</figcaption>
</figure>
</div>
</div>
</div>
<p>A premissa de homocedasticidade da resposta de interesse considerando as replicações realizadas, deve ser confirmada. Em caso de heterocedasticidade, o modelo de regressão não apresentará eficiência na previsão. O teste de homocedasticidade de Bartlett pode ser utilizado no R com a sintaxe à seguir. Deve-se utilizar a função <code>interaction()</code> para considerar a variância dentro das combinações dos níveis dos fatores. A hipótese nula do teste garante a homogeneidade de variância dos dados. Para o <a href="#exm-ex1" class="quarto-xref">Exemplo&nbsp;<span>5.1</span></a>, como <span class="math inline">\(p-valor = 0,5306 &gt; 0,05 = \alpha\)</span>, não rejeita-se a hipótese de homocedasticidade do tamanho de grão.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># teste de homocedasticidade</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bartlett.test</span>(grao <span class="sc">~</span> <span class="fu">interaction</span>(x1,x2,x3), <span class="at">data=</span>planej)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Bartlett test of homogeneity of variances

data:  grao by interaction(x1, x2, x3)
Bartlett's K-squared = 6,079, df = 7, p-value = 0,5306</code></pre>
</div>
</div>
<p>Pode-se utilizar o pacote <code>FrF2</code> para criar o planejamento e, ao invés de utilizar o comando <code>lm</code> deste pacote para análise, pode-se utilizar o comando homônimo base do R para análise. Isto permite obter modelos completos de terceira ordem ou maior ou modelos reduzidos de forma mais simples. O modelo completo, conforme o obtido passo a passo ao se explicar os cálculos relacionados à regressão e ANOVA, pode ser obtido conforme segue.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo completo</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>lm_grao3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> grao <span class="sc">~</span> (x1<span class="sc">*</span>x2<span class="sc">*</span>x3), <span class="at">data =</span> plan)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_grao3)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm.default(formula = grao ~ (x1 * x2 * x3), data = plan)

Residuals:
   Min     1Q Median     3Q    Max 
  -0,4   -0,1    0,0    0,1    0,4 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  9,11250    0,04948 184,179  &lt; 2e-16 ***
x11          0,21250    0,04948   4,295 0,000556 ***
x21          2,38750    0,04948  48,255  &lt; 2e-16 ***
x31          2,01250    0,04948  40,676  &lt; 2e-16 ***
x11:x21     -0,01250    0,04948  -0,253 0,803759    
x11:x31     -0,03750    0,04948  -0,758 0,459508    
x21:x31      0,53750    0,04948  10,864 8,57e-09 ***
x11:x21:x31 -0,01250    0,04948  -0,253 0,803759    
---
Signif. codes:  0 '***' 0,001 '**' 0,01 '*' 0,05 '.' 0,1 ' ' 1

Residual standard error: 0,2424 on 16 degrees of freedom
Multiple R-squared:  0,9961,    Adjusted R-squared:  0,9944 
F-statistic: 588,6 on 7 and 16 DF,  p-value: &lt; 2,2e-16</code></pre>
</div>
</div>
<p>Caso o analista queira obter o modelo com interações apenas de segunda ordem utilizando o comando <code>lm</code> base, pode-se utilizar o código à seguir.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo de segunda ordem com comando lm base R</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>lm_grao2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> grao <span class="sc">~</span> (x1<span class="sc">+</span>x2<span class="sc">+</span>x3)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> plan)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_grao2)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finalmente, é possível reduzir o modelo automaticamente utilizando o comando <code>step</code>. Com este comando o algoritmo de eliminação passo a passo com o argumento <code>direction</code> com a opção <code>backward</code> inicia com o modelo completo e, a cada passo, retira o termo menos significativo de forma hierárquica, sendo realizada uma eliminação para trás. A cada termo removido o algoritmo considera o critério de informação de Akaike (<em>Akaike information criteria</em> - AIC), uma métrica que leva em consideração, não somente o erro do modelo, mas o número de termos, penalizando modelos mais complexos (maiores). Para o <a href="#exm-ex1" class="quarto-xref">Exemplo&nbsp;<span>5.1</span></a>, ao se reduzir o modelo obteve-se o maior ajuste com um modelo composto pelos termos lineares e uma interação de segunda ordem apenas, com <span class="math inline">\(R_{aj}^2 = 0,9951\)</span>. A interação <span class="math inline">\(x_2x_3\)</span> permaneceu após a redução do modelo, confirmando que esta explica bem a variabilidade dos dados, conforme <a href="07-rsm.html#fig-interplot" class="quarto-xref">Figura&nbsp;<span>7.8</span></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo reduzido</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>lm_grao_red <span class="ot">&lt;-</span> <span class="fu">step</span>(lm_grao3, <span class="at">direction =</span> <span class="st">"backward"</span>, <span class="at">trace=</span>T)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=-61,76
grao ~ (x1 * x2 * x3)

           Df Sum of Sq     RSS     AIC
- x1:x2:x3  1   0,00375 0,94375 -63,663
&lt;none&gt;                  0,94000 -61,758

Step:  AIC=-63,66
grao ~ x1 + x2 + x3 + x1:x2 + x1:x3 + x2:x3

        Df Sum of Sq    RSS     AIC
- x1:x2  1    0,0037 0,9475 -65,568
- x1:x3  1    0,0337 0,9775 -64,819
&lt;none&gt;               0,9438 -63,663
- x2:x3  1    6,9338 7,8775 -14,737

Step:  AIC=-65,57
grao ~ x1 + x2 + x3 + x1:x3 + x2:x3

        Df Sum of Sq    RSS     AIC
- x1:x3  1    0,0337 0,9813 -66,728
&lt;none&gt;               0,9475 -65,568
- x2:x3  1    6,9338 7,8813 -16,726

Step:  AIC=-66,73
grao ~ x1 + x2 + x3 + x2:x3

        Df Sum of Sq    RSS     AIC
&lt;none&gt;               0,9813 -66,728
- x1     1    1,0837 2,0650 -50,870
- x2:x3  1    6,9338 7,9150 -18,623</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_grao_red)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm.default(formula = grao ~ x1 + x2 + x3 + x2:x3, data = plan)

Residuals:
    Min      1Q  Median      3Q     Max 
-0,3375 -0,1437  0,0125  0,1375  0,4625 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  9,11250    0,04639 196,440  &lt; 2e-16 ***
x11          0,21250    0,04639   4,581 0,000204 ***
x21          2,38750    0,04639  51,468  &lt; 2e-16 ***
x31          2,01250    0,04639  43,384  &lt; 2e-16 ***
x21:x31      0,53750    0,04639  11,587 4,67e-10 ***
---
Signif. codes:  0 '***' 0,001 '**' 0,01 '*' 0,05 '.' 0,1 ' ' 1

Residual standard error: 0,2273 on 19 degrees of freedom
Multiple R-squared:  0,996, Adjusted R-squared:  0,9951 
F-statistic:  1172 on 4 and 19 DF,  p-value: &lt; 2,2e-16</code></pre>
</div>
</div>
<p>É importante confirmar as pressuposições acerca dos resíduos para o modelo escolhido ao final das análises. Pelo teste de normalidade de Shapiro-Wilk não há indícios para rejeição da hipótese de normalidade dos resíduos. A <a href="#fig-resigrao2" class="quarto-xref">Figura&nbsp;<span>5.7</span></a> apresenta os gráficos de resíduos.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  resi_red
W = 0,97152, p-value = 0,7046</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-resigrao2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-resigrao2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-fat2k_files/figure-html/fig-resigrao2-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-resigrao2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5.7: Gráfico de resíduos para o tamanho de grão, modelo reduzido
</figcaption>
</figure>
</div>
</div>
</div>
<p>O gráfico de Pareto tem sido comumente utilizado para plotar o teste t para os coeficientes no fatorial <span class="math inline">\(2^k\)</span>, conforme <a href="#fig-Paretograo" class="quarto-xref">Figura&nbsp;<span>5.8</span></a>. Este gráfico pode ser obtido no R utilizando o pacote <code>pid</code> conforme segue. No caso estudado todos os efeitos foram positivos.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-Paretograo" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Paretograo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-fat2k_files/figure-html/fig-Paretograo-1.png" class="img-fluid figure-img" width="288">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Paretograo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5.8: Gráfico de Pareto dos efeitos
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pid)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>Pareto1 <span class="ot">&lt;-</span> <span class="fu">paretoPlot</span>(lm_grao_red, </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xlab=</span><span class="st">"Efeito"</span>, </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ylab=</span><span class="st">"Magnitude"</span>,</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">legendtitle=</span><span class="st">"Sinal efeito"</span>,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">negative=</span><span class="fu">c</span>(<span class="st">"Negativo"</span>, <span class="st">"blue"</span>),</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">positive=</span><span class="fu">c</span>(<span class="st">"Positivo"</span>, <span class="st">"red"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para obter os valores previstos pelo modelo <span class="math inline">\(\hat{y}\)</span>, considerando o planejamento, pode-se proceder conforme segue, sendo as primeiras observações preditas observadas na <a href="#tbl-predgrao" class="quarto-xref">Tabela&nbsp;<span>5.4</span></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Valores previstos</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="ot">&lt;-</span> lm_grao_red<span class="sc">$</span>fitted</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div id="tbl-predgrao" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-predgrao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;5.4: Primeiras observações e respectivas previsões
</figcaption>
<div aria-describedby="tbl-predgrao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">grao</th>
<th style="text-align: right;">ypred</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">5,1</td>
<td style="text-align: right;">5,0375</td>
</tr>
<tr class="even">
<td style="text-align: right;">5,6</td>
<td style="text-align: right;">5,4625</td>
</tr>
<tr class="odd">
<td style="text-align: right;">8,6</td>
<td style="text-align: right;">8,7375</td>
</tr>
<tr class="even">
<td style="text-align: right;">9,1</td>
<td style="text-align: right;">9,1625</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7,7</td>
<td style="text-align: right;">7,9875</td>
</tr>
<tr class="even">
<td style="text-align: right;">8,4</td>
<td style="text-align: right;">8,4125</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>O experimentador pode também desejar utilizar o modelo obtido para prever observações em condições diferentes das testadas no planejamento. Entretanto, recomenda-se não extrapolar a região do planejamento, uma vez que o erro de previsão fora da região experimental é alto. Seja um ponto de interesse na região experimental para previsão <span class="math inline">\(\mathbf{x}_0^T = [x_1,...,x_k,x_{12},...,x_{(k-1)k}]^T\)</span>, de ordem <span class="math inline">\(r\times1\)</span>. Pode-se obter o valor previsto neste ponto conforme <a href="#eq-predx0" class="quarto-xref">Equação&nbsp;<span>5.13</span></a>.</p>
<p><span id="eq-predx0"><span class="math display">\[
\hat{y} = \mathbf{x}_0^T\boldsymbol{\hat{\beta}}
\tag{5.13}\]</span></span></p>
<p>Para prever novas observações pode-se utilizar o comando <code>predict</code>. Supondo que o experimentador deseja prever o tamanho de grão para <span class="math inline">\(X_1 = 1100\)</span> ºC, <span class="math inline">\(X_2 = 850\)</span> ºC e <span class="math inline">\(X_3 = 600\)</span> ºC, é importante codificar estes valores antes de avaliá-los no modelo. A <a href="#eq-codfac" class="quarto-xref">Equação&nbsp;<span>5.14</span></a> deve ser utilizada, onde <span class="math inline">\(X_{j(0)} = (X_{j(+)}+X_{j(-)})/2\)</span>. Para os níveis originais desejados os níveis codificados são <span class="math inline">\(x_1 = 1/3\)</span>, <span class="math inline">\(x_2 = -1/3\)</span> e <span class="math inline">\(x_3 = -1/3\)</span>.</p>
<p><span id="eq-codfac"><span class="math display">\[
x_j = \frac{X_j-X_{j(0)}}{(X_{j(+)}-X_{j(-)})/2}
\tag{5.14}\]</span></span></p>
<p>Para utilizar o comando <code>predict</code> para previsão em níveis intermediários para fatores numpericos, recomenda-se que o planejamento não tenha sido criado via pacote <code>FrF2</code>, uma vez que este só permite a previsão nos níveis experimentais. Deste modo, pode-se retomar o planejamento criado com o comando <code>expand.grid</code> e estimar um modelo reduzido a partir deste planejamento utilizando o comando <code>lm</code>. É importante recordar que o fatorial <span class="math inline">\(2^k\)</span> pode ser considerado para fatores categóricos, de forma que apenas previsões nas condições testadas no planejamento sejam possíveis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo completo utilizando planejamento planej</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>lm4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> grao <span class="sc">~</span> (x1<span class="sc">*</span>x2<span class="sc">*</span>x3), <span class="at">data =</span> planej)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Reduzindo lm4 via backward</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>lm_red <span class="ot">&lt;-</span> <span class="fu">step</span>(lm4, <span class="at">direction =</span> <span class="st">"backward"</span>, <span class="at">trace =</span> F)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Valores de x para previsão</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x1 =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, </span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">x2 =</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, </span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">x3 =</span> <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Previsão</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>y_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> lm_red, </span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">newdata =</span> x)</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>y_pred</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
7,776389 </code></pre>
</div>
</div>
<p>O experimentador pode desejar obter um modelo decodificado, isto é nas unidades originais. Para tal, sugere-se utilizar os comandos base R, conforme segue. Deve-se atentar para nunca realizar o teste <span class="math inline">\(t\)</span> para o modelo nas unidades originais, evitando efeito de escala e unidades de medida no teste, sugerindo-se utilizá-lo apenas realizar gráficos, previsão e ter uma interpretação dos coeficientes nas unidades dos fatores.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Níveis decodificados</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">1150</span>) </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">800</span>, <span class="dv">950</span>) </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>X3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">550</span>, <span class="dv">700</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Planejamento</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>plan_decod <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(X1,X2,X3)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>plan_decod <span class="ot">&lt;-</span> <span class="fu">rbind</span>(plan_decod, plan_decod, plan_decod)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Resposta</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>grao <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">5.6</span>, <span class="fl">8.6</span>, <span class="fl">9.1</span>, <span class="fl">7.7</span>, <span class="fl">8.4</span>, <span class="fl">13.5</span>, <span class="dv">14</span>,</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>           <span class="dv">5</span>, <span class="fl">5.7</span>, <span class="fl">8.5</span>, <span class="fl">9.2</span>, <span class="fl">8.2</span>, <span class="fl">8.3</span>, <span class="fl">13.9</span>, <span class="fl">14.1</span>,</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>           <span class="fl">4.9</span>, <span class="fl">5.2</span>, <span class="dv">9</span>, <span class="fl">9.3</span>, <span class="fl">8.1</span>, <span class="fl">8.5</span>, <span class="fl">14.3</span>, <span class="fl">14.5</span>)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>plan_decod<span class="sc">$</span>grao <span class="ot">&lt;-</span> grao</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Nomes colunas</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(plan_decod) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"X1"</span>, <span class="st">"X2"</span>, <span class="st">"X3"</span>, <span class="st">"y"</span>)</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo completo</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>lm_decod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> grao <span class="sc">~</span> X1<span class="sc">*</span>X2<span class="sc">*</span>X3, <span class="at">data =</span> plan_decod)</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo reduzido </span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>lm_decod <span class="ot">&lt;-</span> <span class="fu">step</span>(lm_decod, <span class="at">direction =</span> <span class="st">"backward"</span>, <span class="at">trace =</span> F)</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a><span class="co"># apenas exibir, com modelo decodificado</span></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a><span class="co"># nunca fazer teste t e ANOVA </span></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>lm_decod</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm.default(formula = grao ~ X1 + X2 + X3 + X2:X3, data = plan_decod)

Coefficients:
(Intercept)           X1           X2           X3        X2:X3  
  1,370e+01    2,833e-03   -2,789e-02   -5,678e-02    9,556e-05  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Valores de x para previsão</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">X1 =</span> <span class="dv">1100</span>, </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">X2 =</span> <span class="dv">850</span>, </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">X3 =</span> <span class="dv">600</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Previsão</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>y_pred_decod <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> lm_decod, </span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">newdata =</span> X)</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>y_pred_decod</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
7,776389 </code></pre>
</div>
</div>
<p>Pode-se utilizar o modelo nas unidades originais para obter gráficos de efeitos. A <a href="#fig-effectdecod" class="quarto-xref">Figura&nbsp;<span>5.9</span></a> ilustra os gráficos de efeitos principais, com código exibido à seguir. É importante fixar a amplitude do eixo y para os três gráficos, para fins de comparação dos efeitos, além de considerar os valores preditos para realizar o gráfico. Em um modelo completo usar a média das replicações daria no mesmo resultado que os valores previstos. Entretanto, ao se reduzir o modelo, as previsões são distintas das médias das réplicas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>plan_decod<span class="sc">$</span>fit <span class="ot">&lt;-</span> lm_decod<span class="sc">$</span>fitted.values</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>plan_dec_x1 <span class="ot">&lt;-</span> plan_decod <span class="sc">|&gt;</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(X1, <span class="at">group=</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">y =</span> <span class="fu">mean</span>(fit)) <span class="sc">|&gt;</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">!</span>y, as.factor))</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>plan_dec_x2 <span class="ot">&lt;-</span> plan_decod <span class="sc">|&gt;</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(X2, <span class="at">group=</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">y =</span> <span class="fu">mean</span>(fit)) <span class="sc">|&gt;</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">!</span>y, as.factor))</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>plan_dec_x3 <span class="ot">&lt;-</span> plan_decod <span class="sc">|&gt;</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(X3, <span class="at">group=</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">y =</span> <span class="fu">mean</span>(fit)) <span class="sc">|&gt;</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">!</span>y, as.factor))</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>range_y <span class="ot">&lt;-</span> (<span class="fu">c</span>(<span class="fu">min</span>(plan_dec_x1<span class="sc">$</span>y,plan_dec_x2<span class="sc">$</span>y,plan_dec_x3<span class="sc">$</span>y),</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>              <span class="fu">max</span>(plan_dec_x1<span class="sc">$</span>y,plan_dec_x2<span class="sc">$</span>y,plan_dec_x3<span class="sc">$</span>y)))</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>px1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plan_dec_x1, </span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>X1, <span class="at">y=</span>y)) <span class="sc">+</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col=</span><span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">col=</span><span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(range_y) <span class="sc">+</span> </span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="st">"y ["</span> <span class="sc">*</span> mu <span class="sc">*</span> <span class="st">"m]"</span>)) <span class="sc">+</span></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"X1 [ºC]"</span>)</span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>px2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plan_dec_x2, </span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>X2, <span class="at">y=</span>y)) <span class="sc">+</span></span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col=</span><span class="st">"green4"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">col=</span><span class="st">"green4"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(range_y) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="st">"y ["</span> <span class="sc">*</span> mu <span class="sc">*</span> <span class="st">"m]"</span>)) <span class="sc">+</span></span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"X2 [ºC]"</span>)</span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>px3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plan_dec_x3, </span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>X3, <span class="at">y=</span>y)) <span class="sc">+</span></span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">col=</span><span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(range_y) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="st">"y ["</span> <span class="sc">*</span> mu <span class="sc">*</span> <span class="st">"m]"</span>)) <span class="sc">+</span></span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"X3 [ºC]"</span>)</span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(px1, px2, px3, <span class="at">ncol =</span> <span class="dv">3</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-effectdecod" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-effectdecod-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-fat2k_files/figure-html/fig-effectdecod-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-effectdecod-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5.9: Gráficos de efeitos principais para o modelo final
</figcaption>
</figure>
</div>
</div>
</div>
<p>A <a href="#fig-effectdecint" class="quarto-xref">Figura&nbsp;<span>5.10</span></a> ilustra o gráfico de interação entre X2 e X3 para o modelo final, com código para obtê-lo exibido à seguir. As outras interações não serão consideradas, uma vez que não estão no modelo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>plan_dec_means <span class="ot">&lt;-</span> plan_decod <span class="sc">|&gt;</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(X2,X3) <span class="sc">|&gt;</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">y =</span> <span class="fu">mean</span>(fit)) <span class="sc">|&gt;</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">!</span>y, as.factor))</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plan_dec_means, </span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>X2, <span class="at">group=</span>X3, <span class="at">col=</span>X3, <span class="at">y=</span>y)) <span class="sc">+</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">lty=</span>X3), <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape=</span>X3), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"X2 [ºC]"</span>) <span class="sc">+</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">col =</span> <span class="st">"X3 [ºC]"</span>, <span class="at">lty =</span> <span class="st">"X3 [ºC]"</span>, <span class="at">shape =</span> <span class="st">"X3 [ºC]"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-effectdecint" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-effectdecint-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-fat2k_files/figure-html/fig-effectdecint-1.png" class="img-fluid figure-img" width="336">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-effectdecint-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5.10: Gráficos de interação entre X2 e X3 para o modelo final
</figcaption>
</figure>
</div>
</div>
</div>
<p>Nos casos onde os fatores em estudo são quantitativos, é comum utilizar gráficos de contorno para visualizar o efeito de dois fatores de controle na resposta de interesse. Para tal fim, pode-se utilizar o pacote gráfico <code>ggplot2</code>. O código à seguir permite a obtenção dos gráficos de contorno exibidos na <a href="#fig-contfac" class="quarto-xref">Figura&nbsp;<span>5.11</span></a>, considerando <span class="math inline">\(x_2\)</span> no eixo horizontal, <span class="math inline">\(x_3\)</span> no vertical e <span class="math inline">\(x_1\)</span> fixo nos painéis. É possível adaptar o código considerando o fator <span class="math inline">\(x_3\)</span> em um dos eixos. Neste caso optou-se por considerar a resposta em função das variáveis <span class="math inline">\(x_2\)</span> e <span class="math inline">\(x_3\)</span> por serem as mais significativas individualmente além de comporem a única interação significativa.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Malha</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>X_levels <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">X1 =</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">1150</span>),</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">X2 =</span> <span class="fu">seq</span>(<span class="dv">800</span>, <span class="dv">950</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">X3 =</span> <span class="fu">seq</span>(<span class="dv">550</span>, <span class="dv">700</span>, <span class="at">by =</span> <span class="dv">1</span>))</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co"># prevendo valores em toda malha</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predict</span>(lm_decod,</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">newdata =</span> X_levels))</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(y) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"y"</span>)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="co"># dados para gráfico</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">cbind</span>(X_levels, y)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de contorno</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dados,</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> X2, <span class="at">y =</span> X3, <span class="at">z =</span> y, <span class="at">fill =</span> y)) <span class="sc">+</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="sc">~</span>X1, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"RdYlGn"</span>,</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">color =</span> <span class="st">"navy"</span>) <span class="sc">+</span></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-contfac" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-contfac-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-fat2k_files/figure-html/fig-contfac-1.png" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-contfac-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5.11: Gráfico de contorno do tamanho de grão em função de X2 e X3, com X1 = 1000 e X1 = 1150 ºC
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="propriedades-do-fatorial-2k" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="propriedades-do-fatorial-2k"><span class="header-section-number">5.3</span> Propriedades do fatorial <span class="math inline">\(2^k\)</span></h2>
<p>É essencial entender as propriedades do planejamento fatorial <span class="math inline">\(2^k\)</span> e suas implicações no erro experimental e na qualidade do modelo de regressão obtido. Seja o vetor de coeficientes de regressão obtido por mínimos quadrados, <span class="math inline">\(\mathbf{\beta}\)</span> conforme <a href="#eq-minsqb" class="quarto-xref">Equação&nbsp;<span>5.7</span></a>. No fatorial <span class="math inline">\(2^k\)</span>, pode-se constatar que</p>
<p><span class="math display">\[
\mathbf{X}^T\mathbf{X} = \mathbf{I}N
\]</span></p>
<p>onde <span class="math inline">\(\mathbf{I}\)</span> é uma matriz identidade. Deste modo, <span class="math inline">\((\mathbf{X}^T\mathbf{X})^{-1} = \mathbf{I}/N\)</span>, pois uma matriz diagonal pode ser invertida tomando os inversos dos elementos não nulos contidos na diagonal. Logo, os estimadores de mínimos quadrados, estritamente no caso do fatorial <span class="math inline">\(2^k\)</span>, podem ser ser reescritos conforme a <a href="#eq-betasimples" class="quarto-xref">Equação&nbsp;<span>5.15</span></a>. Em outros planejamentos para modelos quadráticos ou em estudos de regressão sem experimentos planejados, <span class="math inline">\(\mathbf{X}^T\mathbf{X}\)</span> e sua inversa não serão diagonais, não valendo a <a href="#eq-betasimples" class="quarto-xref">Equação&nbsp;<span>5.15</span></a>.</p>
<p><span id="eq-betasimples"><span class="math display">\[
\boldsymbol{\beta} = \mathbf{X}^T\mathbf{y}/N
\tag{5.15}\]</span></span></p>
<p>Tomando a matrix <span class="math inline">\(\mathbf{X}\)</span>, os momentos de primeira ordem desta matriz, os quais consistem na média de cada coluna, isto é, <span class="math inline">\(\sum_{u=1}^Nx_{iu}/N=0\)</span> sendo nulos garantem que o planejamento é balanceado, com cada fator sendo avaliado o mesmo número de vezes em cada nível.</p>
<p>Tomando a matrix <span class="math inline">\(\mathbf{X}\)</span> do planejamento os momentos de segunda ordem mistos da matriz, que consistem na média do produto de duas colunas distintas, também são nulos, isto é, <span class="math inline">\(\sum_{u=1}^Nx_{iu}x_{ju}/N=0\)</span>, <span class="math inline">\(i \ne j\)</span> garantindo a independência na estimativa dos coeficientes. Já os momentos de segunda ordem puros são unitários, <span class="math inline">\(\sum_{u=1}^Nx_{iu}^2/N=1\)</span>. Estes dois resultados garantem que <span class="math inline">\(\mathbf{X}^T\mathbf{X}\)</span> é diagonal, garantindo a independência na estimativa dos coeficientes de regressão.</p>
<p>Pode-se demonstrar que a matriz <span class="math inline">\(\mathbf{X}^T\mathbf{X}\)</span> é diagonal, conforme segue.</p>
<p><span class="math display">\[\mathbf{X}^T\mathbf{X} = \begin{bmatrix}
\sum_{u=1}^N 1^2 &amp; \sum_{u=1}^N x_1x_2 &amp; ... &amp; \sum_{u=1}^N x_1x_r \\
\sum_{u=1}^N x_2x_1 &amp; \sum_{u=1}^N x_1^2 &amp; ... &amp; \sum_{u=1}^N x_2x_r \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\sum_{u=1}^N x_rx_1 &amp; \sum_{u=1}^N x_rx_2 &amp; ... &amp; \sum_{u=1}^N x_r^2 \\
\end{bmatrix} = \begin{bmatrix}
N &amp; 0 &amp; 0 &amp; 0\\
0 &amp; N &amp; 0 &amp; 0\\
0 &amp; 0 &amp; N &amp; 0\\
0 &amp; 0 &amp; 0 &amp; N\\
\end{bmatrix} = \mathbf{I}N\]</span></p>
<p>Pode-se demonstrar que a variância dos coeficientes de regressão depende não somente do erro experimental, mas também do planejamento. Aplicando o operador de variância na <a href="#eq-minsqb" class="quarto-xref">Equação&nbsp;<span>5.7</span></a>, tem-se:</p>
<p><span class="math display">\[
Var(\hat{\boldsymbol{\beta}}) = Var((\mathbf{X}^T\mathbf{X})^{-1}(\mathbf{X}^T\mathbf{y}))
\]</span> <span class="math display">\[
Var(\hat{\boldsymbol{\beta}}) = ((\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T)^TVar(\mathbf{y})(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T
\]</span> <span class="math display">\[
Var(\hat{\boldsymbol{\beta}}) = (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{X}Var(\mathbf{y})(\mathbf{X}^T\mathbf{X})^{-1}
\]</span> <span class="math display">\[
Var(\hat{\boldsymbol{\beta}}) = \mathbf{I}Var(\mathbf{y})(\mathbf{X}^T\mathbf{X})^{-1}
\]</span> <span id="eq-varbeta"><span class="math display">\[
Var(\hat{\boldsymbol{\beta}}) = \hat\sigma^2(\mathbf{X}^T\mathbf{X})^{-1}
\tag{5.16}\]</span></span></p>
<p>É importante recordar que constantes saem do operador de variância elevadas ao quadrado, o que em operação matricial equivale a multiplicar pela transposta. A transposta de uma matriz diagonal também é a própria matriz diagonal e uma matriz ao ser multiplicada por sua inversa resulta em uma matriz identidade. Logo, a variância dos coeficientes depende da variância experimental <span class="math inline">\(\hat\sigma^2 = MS_E\)</span> e da variância do planejamento <span class="math inline">\((\mathbf{X}^T\mathbf{X})^{-1}\)</span>, que consiste em uma matriz diagonal de ordem <span class="math inline">\(r \times r\)</span>.</p>
<p>Como no caso dos fatoriais <span class="math inline">\(2^k\)</span> a variância da matriz <span class="math inline">\(\mathbf{X}\)</span> é a razão entre uma matriz identidade e o número de experimentos, isto é, <span class="math inline">\((\mathbf{X}^T\mathbf{X})^{-1} = \mathbf{I}/N = \mathbf{I}/(n2^k)\)</span>, a variância de cada coeficiente pode ser escrita conforme a <a href="#eq-varbetai" class="quarto-xref">Equação&nbsp;<span>5.17</span></a>. Logo, quanto maior o número de replicações, menor a variância dos coeficientes. Este resultado é uma implicação do teorema central do limite.</p>
<p><span id="eq-varbetai"><span class="math display">\[
Var(\hat{\beta}_i) = \hat{\sigma}^2/N
\tag{5.17}\]</span></span></p>
<p>A variância de previsão em um ponto de interesse <span class="math inline">\(\mathbf{x}_0\)</span> na região experimental pode ser escrita conforme segue, aplicando o operador de variância na <a href="#eq-predx0" class="quarto-xref">Equação&nbsp;<span>5.13</span></a>.</p>
<p><span class="math display">\[
Var(\hat{y}) = Var(\mathbf{x}_0^T\boldsymbol{\hat{\beta}})
\]</span> <span class="math display">\[
Var(\hat{y}) = \mathbf{x}_0^TVar(\boldsymbol{\hat{\beta}})\mathbf{x}_0
\]</span> <span class="math display">\[
Var(\hat{y}) = \mathbf{x}_0^TVar(\boldsymbol{\hat{\beta}})\mathbf{x}_0
\]</span> <span class="math display">\[
Var(\hat{y}) = \mathbf{x}_0^T\hat{\sigma}^2(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{x}_0
\]</span> <span id="eq-varypred"><span class="math display">\[
Var(\hat{y}) = \hat{\sigma}^2\mathbf{x}_0^T(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{x}_0
\tag{5.18}\]</span></span></p>
<p>Logo, a variância de previsão depende do ponto de interesse <span class="math inline">\(\mathbf{x}_0\)</span> na região experimental, da variância do planejamento, <span class="math inline">\((\mathbf{X}^T\mathbf{X})^{-1}\)</span>, e da variância experimental <span class="math inline">\(\hat{\sigma}^2\)</span>.</p>
<p>Uma vez que a variância de previsão depende do erro experimental, pode-se utilizar uma medida escalonada de variância, dividindo o resultado da <a href="#eq-varypred" class="quarto-xref">Equação&nbsp;<span>5.18</span></a> pela variância experimental, <span class="math inline">\(\hat{\sigma^2}\)</span>, e multiplicando por <span class="math inline">\(N\)</span>, obtendo-se a variância escalonada de previsão <em>scaled prediction variance</em> (SPV), conforme a <a href="#eq-spv" class="quarto-xref">Equação&nbsp;<span>5.19</span></a>. Ao se multiplicar a medida por <span class="math inline">\(N\)</span>, previne-se o aumento do número de replicações para diminuir a variância do planejamento, uma vez que aumentar o número de ensaios implica no aumento dos custos de experimentação, contrariando o princípio de economia na experimentação. Já ao dividir por <span class="math inline">\(\hat{\sigma}^2\)</span> obtém-se uma medida livre do erro experimental, de forma que a <span class="math inline">\(SPV\)</span> pode ser usada para comparar planejamentos.</p>
<p><span id="eq-spv"><span class="math display">\[
SPV = Var(\hat{y})N/\hat{\sigma}^2 = N\mathbf{x}_0^T(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{x}_0
\tag{5.19}\]</span></span></p>
<p>Pode-se obter a matriz de variância do planejamento, com a seguinte sintaxe no R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Planejamento</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>pl <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(levels, levels, levels)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pl) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="co"># matriz X</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="at">object =</span> <span class="sc">~</span> x1<span class="sc">*</span>x2<span class="sc">*</span>x3, <span class="at">data =</span> pl)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>X</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  (Intercept) x1 x2 x3 x1:x2 x1:x3 x2:x3 x1:x2:x3
1           1 -1 -1 -1     1     1     1       -1
2           1  1 -1 -1    -1    -1     1        1
3           1 -1  1 -1    -1     1    -1        1
4           1  1  1 -1     1    -1    -1       -1
5           1 -1 -1  1     1    -1    -1        1
6           1  1 -1  1    -1     1    -1       -1
7           1 -1  1  1    -1    -1     1       -1
8           1  1  1  1     1     1     1        1
attr(,"assign")
[1] 0 1 2 3 4 5 6 7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Número de experimentos</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">dim</span>(X)[<span class="dv">1</span>]</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Variância de X</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>var_X <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>var_X</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            (Intercept)    x1    x2    x3 x1:x2 x1:x3 x2:x3 x1:x2:x3
(Intercept)       0,125 0,000 0,000 0,000 0,000 0,000 0,000    0,000
x1                0,000 0,125 0,000 0,000 0,000 0,000 0,000    0,000
x2                0,000 0,000 0,125 0,000 0,000 0,000 0,000    0,000
x3                0,000 0,000 0,000 0,125 0,000 0,000 0,000    0,000
x1:x2             0,000 0,000 0,000 0,000 0,125 0,000 0,000    0,000
x1:x3             0,000 0,000 0,000 0,000 0,000 0,125 0,000    0,000
x2:x3             0,000 0,000 0,000 0,000 0,000 0,000 0,125    0,000
x1:x2:x3          0,000 0,000 0,000 0,000 0,000 0,000 0,000    0,125</code></pre>
</div>
</div>
<p>O pacote <code>vdg</code> é uma opção para se obter a SPV em função do raio do planejamento. A <a href="#fig-vdgfat23" class="quarto-xref">Figura&nbsp;<span>5.12</span></a> plota a variância escalonada de previsão em função do raio do planejamento para o fatorial <span class="math inline">\(2^3\)</span>. Este tipo de gráfico é chamado de gráfico de dispersão de variância. Pode-se observar que à medida que o ponto de interesse se afasta do centro do planejamento, a variância escalonada de previsão aumenta. É natural, portanto, que fora da região experimental, isto é, fora dos limites do planejamento, a capacidade de previsão do modelo obtido seja baixa, visto que as variâncias do planejamento e de previsão aumentam com o aumento da distância do centro do planejamento.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Carregando pacote vdg</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vdg)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gerando valores de spv p/ planejamento pl</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">spv</span>(<span class="at">n =</span> <span class="dv">10000</span>, <span class="at">design =</span> pl, <span class="at">type =</span> <span class="st">"cuboidal"</span>, <span class="at">formula =</span> <span class="sc">~</span>(x1<span class="sc">*</span>x2<span class="sc">*</span>x3))</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plotando (função plot do pacote vdg)</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out, <span class="at">which =</span> <span class="st">"fds"</span>)<span class="sc">$</span>fds <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-vdgfat23" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-vdgfat23-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-fat2k_files/figure-html/fig-vdgfat23-1.png" class="img-fluid figure-img" width="240">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-vdgfat23-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5.12: Gráfico de dispersão de variância para o fatorial <span class="math inline">\(2^k\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="bibliografia" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="bibliografia">Bibliografia</h2>
<p>BANCROFT, Theodore Alfonso. On biases in estimation due to the use of preliminary tests of significance. <em>The Annals of Mathematical Statistics</em>, v. 15, n.&nbsp;2, p.&nbsp;190-204, 1944.</p>
<p>BARNARD, M. M. An Enumeration of the Confounded Arrangements in the 2× 2× 2… Factorial Designs. <em>Supplement to the Journal of the Royal Statistical Society</em>, v. 3, n.&nbsp;2, p.&nbsp;195-202, 1936.</p>
<p>BOX, G. E. P. Multi-factor designs of first order. <em>Biometrika</em>, v. 39, n.&nbsp;1-2, p.&nbsp;49-57, 1952.</p>
<p>COX, D. R. Some systematic experimental designs. <em>Biometrika</em>, v. 38, n.&nbsp;3/4, p.&nbsp;312-323, 1951.</p>
<p>FANG, Kai-Tai et al.&nbsp;Uniform design: theory and application. <em>Technometrics</em>, v. 42, n.&nbsp;3, p.&nbsp;237-248, 2000.</p>
<p>FISHER, Ronald A. <em>The design of experiments</em>. 1949.</p>
<p>IS’ HAQ, A. Mohammed et al.&nbsp;Full factorial design approach to carbon nanotubes synthesis by CVD method in argon environment. <em>South african journal of chemical engineering</em>, v. 24, p.&nbsp;17-42, 2017.</p>
<p>KELLY, Matthew R. et al.&nbsp;Experimental investigation of linear friction welding of AISI 1020 steel with pre-heating. <em>Journal of Manufacturing Processes</em>, v. 39, p.&nbsp;26-39, 2019.</p>
<p>MEE, Robert. <em>A comprehensive guide to factorial two-level experimentation</em>. Springer Science &amp; Business Media, 2009.</p>
<p>SNEDECOR, G. W. <em>Statistical Methods: Applied to Experiments in Agriculture</em>.. 1956.</p>
<p>YATES, Frank. <em>The design and analysis of factorial experiments</em>. Harpenden, UK: Imperial Bureau of Soil Science, 1978.</p>
<p>ZHANG, Chunyong et al.&nbsp;Anodic treatment of acrylic fiber manufacturing wastewater with boron-doped diamond electrode: a statistical approach. <em>Chemical Engineering Journal</em>, v. 161, n.&nbsp;1-2, p.&nbsp;93-98, 2010.</p>
</section>
<section id="exercícios" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="exercícios"><span class="header-section-number">5.4</span> Exercícios</h2>
<ol type="1">
<li>O artigo utilizou um planejamento fatorial completo <span class="math inline">\(2^3\)</span> para estudar a adsorção do corante vermelho neutro em areia de fundição residual (WFS). Foram considerados 3 fatores, cada um em 2 níveis, seno realizadas duas réplicas. Os fatores considerados são: Tempo de contato (A): 5 min e 120 min; Concentração inicial do corante (B): 30 mg/L e 300 mg/L; Dosagem de adsorvente (C): 2,5 g/L e 20 g/L. Como resposta foi avaliada a eficiência de remoção do corante vermelho neutro (%) da solução aquosa. O planejamento é apresentado na <a href="#tbl-planfat2k1" class="quarto-xref">Tabela&nbsp;<span>5.5</span></a>.</li>
</ol>
<div class="cell">
<div id="tbl-planfat2k1" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-planfat2k1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;5.5: Planejamento fatorial 2^3 para estudar a adsorção do corante vermelho neutro em areia de fundição residual
</figcaption>
<div aria-describedby="tbl-planfat2k1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">tempo</th>
<th style="text-align: left;">concentração</th>
<th style="text-align: left;">dosagem</th>
<th style="text-align: right;">rendimento</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">2,5</td>
<td style="text-align: right;">77,93</td>
</tr>
<tr class="even">
<td style="text-align: left;">120</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">2,5</td>
<td style="text-align: right;">94,46</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">300</td>
<td style="text-align: left;">2,5</td>
<td style="text-align: right;">3,33</td>
</tr>
<tr class="even">
<td style="text-align: left;">120</td>
<td style="text-align: left;">300</td>
<td style="text-align: left;">2,5</td>
<td style="text-align: right;">15,10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">20</td>
<td style="text-align: right;">93,36</td>
</tr>
<tr class="even">
<td style="text-align: left;">120</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">20</td>
<td style="text-align: right;">98,70</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">300</td>
<td style="text-align: left;">20</td>
<td style="text-align: right;">13,33</td>
</tr>
<tr class="even">
<td style="text-align: left;">120</td>
<td style="text-align: left;">300</td>
<td style="text-align: left;">20</td>
<td style="text-align: right;">90,03</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">2,5</td>
<td style="text-align: right;">75,45</td>
</tr>
<tr class="even">
<td style="text-align: left;">120</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">2,5</td>
<td style="text-align: right;">90,88</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">300</td>
<td style="text-align: left;">2,5</td>
<td style="text-align: right;">5,23</td>
</tr>
<tr class="even">
<td style="text-align: left;">120</td>
<td style="text-align: left;">300</td>
<td style="text-align: left;">2,5</td>
<td style="text-align: right;">16,12</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">20</td>
<td style="text-align: right;">94,33</td>
</tr>
<tr class="even">
<td style="text-align: left;">120</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">20</td>
<td style="text-align: right;">97,10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">300</td>
<td style="text-align: left;">20</td>
<td style="text-align: right;">11,98</td>
</tr>
<tr class="even">
<td style="text-align: left;">120</td>
<td style="text-align: left;">300</td>
<td style="text-align: left;">20</td>
<td style="text-align: right;">88,46</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<ol type="a">
<li><p>Obtenha o planejamento no R.</p></li>
<li><p>Obtenha o modelo de regressão e faça o teste t para os coeficientes do modelo completo. Avalie a significância de cada termo considerado.</p></li>
<li><p>Obtenha a ANOVA e avalie o ajuste do modelo.</p></li>
<li><p>Avalie as pressuposições de normalidade e homocedasticidade.</p></li>
<li><p>Faça os gráficos de efeitos principais e de interação para os termos significativos e interprete os efeitos observados.</p></li>
<li><p>Faça gráficos de contorno e junto com os outros gráficos, avalie qual condição maximiza o rendimento da remoção de corante.</p></li>
</ol>
<p>Çoruh, S., &amp; Gürkan, E. H. (2014). Adsorption of neutral red from aqueous solutions using waste foundry sand: full factorial design analysis. Environmental Progress &amp; Sustainable Energy, 33(4), 1086-1095.</p>
<ol start="2" type="1">
<li>O estudo de Ananthanarayanan et al.&nbsp;(2019) buscou modelar os parâmetros de encruamento em pré-formas de alumínio sinterizado e alumínio com 1% de carbono, submetidas a conformação a frio por compressão (cold upsetting). Foi utilizado um planejamento fatorial completo <span class="math inline">\(2^3\)</span>, ou seja, três fatores com dois níveis cada. Foram estudados o efeito da composição (C): Alumínio puro e Alumínio + 1% Carbono; da temperatura de sinterização (T): 495 e 561 °C; e do lubrificante a seco e estearato de zinco (E-Zinco). Uma das respostas avaliada foi o coeficiente de resistência ao escoamento (K, em MPa). O planejamento foi replicado duas vezes, conforme apresentado na <a href="#tbl-planfat2k2" class="quarto-xref">Tabela&nbsp;<span>5.6</span></a>.</li>
</ol>
<!-- -->
<ol type="a">
<li><p>Obtenha o planejamento no R.</p></li>
<li><p>Obtenha o modelo de regressão e faça o teste t para os coeficientes do modelo completo. Avalie a significância de cada termo considerado.</p></li>
<li><p>Obtenha a ANOVA e avalie o ajuste do modelo.</p></li>
<li><p>Avalie as pressuposições de normalidade e homocedasticidade.</p></li>
<li><p>Faça os gráficos de efeitos principais e de interação para os termos significativos e interprete os efeitos observados.</p></li>
</ol>
<div class="cell">
<div id="tbl-planfat2k2" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-planfat2k2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;5.6: Planejamento fatorial 2^3 para estudar o encruamento em pré-formas de alumínio sinterizado na conformação a frio por compressão
</figcaption>
<div aria-describedby="tbl-planfat2k2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Composição</th>
<th style="text-align: left;">Temperatura</th>
<th style="text-align: left;">Lubrificante</th>
<th style="text-align: right;">K</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Al</td>
<td style="text-align: left;">495</td>
<td style="text-align: left;">Seco</td>
<td style="text-align: right;">185</td>
</tr>
<tr class="even">
<td style="text-align: left;">Al-1%C</td>
<td style="text-align: left;">495</td>
<td style="text-align: left;">Seco</td>
<td style="text-align: right;">187</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Al</td>
<td style="text-align: left;">561</td>
<td style="text-align: left;">Seco</td>
<td style="text-align: right;">255</td>
</tr>
<tr class="even">
<td style="text-align: left;">Al-1%C</td>
<td style="text-align: left;">561</td>
<td style="text-align: left;">Seco</td>
<td style="text-align: right;">220</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Al</td>
<td style="text-align: left;">495</td>
<td style="text-align: left;">E-Zinco</td>
<td style="text-align: right;">200</td>
</tr>
<tr class="even">
<td style="text-align: left;">Al-1%C</td>
<td style="text-align: left;">495</td>
<td style="text-align: left;">E-Zinco</td>
<td style="text-align: right;">86</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Al</td>
<td style="text-align: left;">561</td>
<td style="text-align: left;">E-Zinco</td>
<td style="text-align: right;">248</td>
</tr>
<tr class="even">
<td style="text-align: left;">Al-1%C</td>
<td style="text-align: left;">561</td>
<td style="text-align: left;">E-Zinco</td>
<td style="text-align: right;">195</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Al</td>
<td style="text-align: left;">495</td>
<td style="text-align: left;">Seco</td>
<td style="text-align: right;">195</td>
</tr>
<tr class="even">
<td style="text-align: left;">Al-1%C</td>
<td style="text-align: left;">495</td>
<td style="text-align: left;">Seco</td>
<td style="text-align: right;">160</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Al</td>
<td style="text-align: left;">561</td>
<td style="text-align: left;">Seco</td>
<td style="text-align: right;">220</td>
</tr>
<tr class="even">
<td style="text-align: left;">Al-1%C</td>
<td style="text-align: left;">561</td>
<td style="text-align: left;">Seco</td>
<td style="text-align: right;">200</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Al</td>
<td style="text-align: left;">495</td>
<td style="text-align: left;">E-Zinco</td>
<td style="text-align: right;">215</td>
</tr>
<tr class="even">
<td style="text-align: left;">Al-1%C</td>
<td style="text-align: left;">495</td>
<td style="text-align: left;">E-Zinco</td>
<td style="text-align: right;">80</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Al</td>
<td style="text-align: left;">561</td>
<td style="text-align: left;">E-Zinco</td>
<td style="text-align: right;">200</td>
</tr>
<tr class="even">
<td style="text-align: left;">Al-1%C</td>
<td style="text-align: left;">561</td>
<td style="text-align: left;">E-Zinco</td>
<td style="text-align: right;">182</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Ananthanarayanan, R., Ahmed, Z., Prasad, A., &amp; Narayan, S. (2019). Strain hardening analysis and modelling of its parameters for sintered Al and Al-1% C preforms during cold upsetting. Journal of Materials Research and Technology, 8(2), 1789-1797.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./04-ANOVA_blocos.html" class="pagination-link" aria-label="Planejamento com blocos completos aleatorizados">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Planejamento com blocos completos aleatorizados</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./06-fatunrep_frac.html" class="pagination-link" aria-label="Fatorial de dois níveis não replicado, com blocos e fracionado">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Fatorial de dois níveis não replicado, com blocos e fracionado</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>